{"pageProps":{"postData":{"id":"Setting-up-actix-in-tauri","contentHtml":"<p>This was an experience where my company team was trying to create a Rust desktop\napp tool for debugging and developing Laravel apps called Krater\n(we later changed to Go ðŸ«£). However, we had an issue trying to connect the\nLaravel apps with the tool and extracting data from them. This was our solution:\nsince we needed a way to connect with websites and extract data, we researched\nthe best ways to do this and discovered Actix Web.</p>\n<p>Actix Web provides a powerful method for handling HTTP requests. By integrating\nit with Tauri, we can create desktop apps with advanced web capabilities. We\nwould like to share our knowledge by providing a basic procedure for setting up\na simple Tauri app with Actix Web.</p>\n<p>Firstly, to integrate Actix Web in our Tauri app, we need to install the Actix\nWeb dependency by adding it to our <code>Cargo.toml</code> file in the following way:</p>\n<pre class=\"language-rust\"><code class=\"language-rust code-highlight\"><span class=\"code-line\"><span class=\"token punctuation\">[</span>dependencies<span class=\"token punctuation\">]</span>\n</span><span class=\"code-line\">tauri <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> version <span class=\"token operator\">=</span> <span class=\"token string\">\"1.2\"</span><span class=\"token punctuation\">,</span> features <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"shell-open\"</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span>\n</span><span class=\"code-line\">serde <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> version <span class=\"token operator\">=</span> <span class=\"token string\">\"1.0\"</span><span class=\"token punctuation\">,</span> features <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"derive\"</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span>\n</span><span class=\"code-line\">serde_json <span class=\"token operator\">=</span> <span class=\"token string\">\"1.0\"</span>\n</span><span class=\"code-line\">actix<span class=\"token operator\">-</span>web <span class=\"token operator\">=</span> <span class=\"token string\">\"4\"</span>\n</span></code></pre>\n<p>Next, we will create the folder structure for our server. Our folder can be set\nup within the <code>src-tauri/src/</code> folder in the following manner:</p>\n<pre><code class=\"code-highlight\"><span class=\"code-line\">src-tauri/\n</span><span class=\"code-line\">\tsrc/\n</span><span class=\"code-line\">\t\tserver/\n</span><span class=\"code-line\">\t\t\tmod.rs\n</span><span class=\"code-line\">\t\t\thandlers/\n</span><span class=\"code-line\">\t\t\t\tmod.rs\n</span><span class=\"code-line\">\t\t\t\texample.rs\n</span></code></pre>\n<p>The <code>server/mod.rs</code> file is the Rust module for our server, while the <code>handler</code>\nfolder is where we can add various endpoints for our API. Let's get started on\ncoding our server module. Navigate to <code>server/mod.rs</code> and create the Actix Web\nmain method that initializes your server as follows:</p>\n<pre class=\"language-rust\"><code class=\"language-rust code-highlight\"><span class=\"code-line\"><span class=\"token keyword\">mod</span> <span class=\"token module-declaration namespace\">handlers</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line\">\n</span><span class=\"code-line\"><span class=\"token keyword\">use</span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span></span><span class=\"token punctuation\">{</span><span class=\"token namespace\">sync<span class=\"token punctuation\">::</span></span><span class=\"token class-name\">Mutex</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line\">\n</span><span class=\"code-line\"><span class=\"token keyword\">use</span> <span class=\"token namespace\">actix_web<span class=\"token punctuation\">::</span></span><span class=\"token punctuation\">{</span>middleware<span class=\"token punctuation\">,</span> web<span class=\"token punctuation\">,</span> <span class=\"token class-name\">App</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">HttpServer</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line\"><span class=\"token keyword\">use</span> <span class=\"token namespace\">tauri<span class=\"token punctuation\">::</span></span><span class=\"token class-name\">AppHandle</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line\">\n</span><span class=\"code-line\"><span class=\"token keyword\">struct</span> <span class=\"token type-definition class-name\">TauriAppState</span> <span class=\"token punctuation\">{</span>\n</span><span class=\"code-line\">    app<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Mutex</span><span class=\"token operator\">&#x3C;</span><span class=\"token class-name\">AppHandle</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n</span><span class=\"code-line\"><span class=\"token punctuation\">}</span>\n</span><span class=\"code-line\">\n</span><span class=\"code-line\"><span class=\"token attribute attr-name\">#[actix_web::main]</span>\n</span><span class=\"code-line\"><span class=\"token keyword\">pub</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">init</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">:</span> <span class=\"token class-name\">AppHandle</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span>io<span class=\"token punctuation\">::</span></span><span class=\"token class-name\">Result</span><span class=\"token operator\">&#x3C;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n</span><span class=\"code-line\">    <span class=\"token keyword\">let</span> tauri_app <span class=\"token operator\">=</span> <span class=\"token namespace\">web<span class=\"token punctuation\">::</span></span><span class=\"token class-name\">Data</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">TauriAppState</span> <span class=\"token punctuation\">{</span>\n</span><span class=\"code-line\">        app<span class=\"token punctuation\">:</span> <span class=\"token class-name\">Mutex</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>app<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n</span><span class=\"code-line\">    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line\">\n</span><span class=\"code-line\">    <span class=\"token class-name\">HttpServer</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">move</span> <span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span><span class=\"token closure-punctuation punctuation\">|</span></span> <span class=\"token punctuation\">{</span>\n</span><span class=\"code-line\">        <span class=\"token class-name\">App</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</span><span class=\"code-line\">            <span class=\"token punctuation\">.</span><span class=\"token function\">app_data</span><span class=\"token punctuation\">(</span>tauri_app<span class=\"token punctuation\">.</span><span class=\"token function\">clone</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</span><span class=\"code-line\">            <span class=\"token punctuation\">.</span><span class=\"token function\">wrap</span><span class=\"token punctuation\">(</span><span class=\"token namespace\">middleware<span class=\"token punctuation\">::</span></span><span class=\"token class-name\">Logger</span><span class=\"token punctuation\">::</span><span class=\"token function\">default</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</span><span class=\"code-line\">            <span class=\"token punctuation\">.</span><span class=\"token function\">service</span><span class=\"token punctuation\">(</span><span class=\"token namespace\">handlers<span class=\"token punctuation\">::</span>example<span class=\"token punctuation\">::</span></span>handle<span class=\"token punctuation\">)</span>\n</span><span class=\"code-line\">    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</span><span class=\"code-line\">    <span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"127.0.0.1\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4875</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token operator\">?</span>\n</span><span class=\"code-line\">    <span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</span><span class=\"code-line\">    <span class=\"token punctuation\">.</span><span class=\"token keyword\">await</span>\n</span><span class=\"code-line\"><span class=\"token punctuation\">}</span>\n</span></code></pre>\n<p>The <code>mod handlers</code> statement defines a submodule that includes a module named\n<code>example</code>. This module is used to handle incoming API requests. Additionally, a\n<code>struct</code> called <code>TauriAppState</code> is defined, which holds an instance of an AppHandle\nfrom the Tauri library. This <code>AppHandle</code> is used to facilitate communication\nbetween the Rust web server and the Tauri desktop application it is designed to\nwork with.</p>\n<p>The <code>init</code> function is an asynchronous function that sets up and configures the\nweb server to handle incoming requests. It accepts an <code>AppHandle</code> as input, which\nis used to create the <code>TauriAppState</code> instance. The <code>tauri_app</code> variable is created\nusing the <code>web::Data</code> struct, which can be used to store application data that can\nbe accessed by different parts of the application. In this case, <code>tauri_app</code> is an\ninstance of <code>TauriAppState</code>.</p>\n<p>The <code>HttpServer</code> struct is then instantiated, and the <code>new</code> method is used to\ncreate a new instance of an Actix-web <code>App</code>. This <code>App</code> instance is configured\nwith several middleware to handle web requests, including the <code>Logger::default()</code>\nmiddleware. The <code>.service()</code> method is called on the <code>App</code> instance, which\nincludes the <code>handlers::example::handle</code> function as an argument. This function\nis the request handler that actually processes incoming web requests.</p>\n<p>Now, to use our example module in the Actix web server, navigate to\n<code>example.rs</code> and add the following code:</p>\n<pre class=\"language-rust\"><code class=\"language-rust code-highlight\"><span class=\"code-line\"><span class=\"token keyword\">use</span> <span class=\"token namespace\">actix_web<span class=\"token punctuation\">::</span></span><span class=\"token punctuation\">{</span>post<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line\">\n</span><span class=\"code-line\"><span class=\"token attribute attr-name\">#[post(<span class=\"token string\">\"/api/test\"</span>)]</span>\n</span><span class=\"code-line\"><span class=\"token keyword\">pub</span> <span class=\"token keyword\">async</span> <span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token namespace\">actix_web<span class=\"token punctuation\">::</span></span><span class=\"token class-name\">Result</span><span class=\"token operator\">&#x3C;</span><span class=\"token class-name\">String</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n</span><span class=\"code-line\">\t<span class=\"token keyword\">let</span> text <span class=\"token operator\">=</span> <span class=\"token string\">\"hello world\"</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line\">  <span class=\"token macro property\">println!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"{}\"</span><span class=\"token punctuation\">,</span>text<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line\">\n</span><span class=\"code-line\">  <span class=\"token class-name\">Ok</span><span class=\"token punctuation\">(</span>text<span class=\"token punctuation\">.</span><span class=\"token function\">to_string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</span><span class=\"code-line\"><span class=\"token punctuation\">}</span>\n</span></code></pre>\n<p>In this code snippet, we are simply printing a \"Hello World\"  message in the\nterminal  to verify that the endpoint is functioning properly.</p>\n<p>The next and most critical step is to navigate to the <code>main.rs</code> file and add\nthe server module that we just created, along with a new standard module called\n\"thread\". This module will play an essential role in running the server and\nhandling incoming requests.</p>\n<pre class=\"language-rust\"><code class=\"language-rust code-highlight\"><span class=\"code-line\"><span class=\"token keyword\">mod</span> <span class=\"token module-declaration namespace\">server</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line\">\n</span><span class=\"code-line\"><span class=\"token keyword\">use</span> <span class=\"token namespace\">std<span class=\"token punctuation\">::</span></span>thread<span class=\"token punctuation\">;</span>\n</span></code></pre>\n<p>To prevent the interruption of our main Tauri app thread, we will use the thread\nmodule to run our server in a separate thread. This allows us to keep our server\nrunning without interfering with the functionality of our main thread. Finally,\nto achieve this, we will chain our main method in the following way:</p>\n<pre class=\"language-rust\"><code class=\"language-rust code-highlight\"><span class=\"code-line\"><span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n</span><span class=\"code-line\">    <span class=\"token namespace\">tauri<span class=\"token punctuation\">::</span></span><span class=\"token class-name\">Builder</span><span class=\"token punctuation\">::</span><span class=\"token function\">default</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n</span><span class=\"code-line\">        <span class=\"token punctuation\">.</span><span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span>app<span class=\"token closure-punctuation punctuation\">|</span></span> <span class=\"token punctuation\">{</span>\n</span><span class=\"code-line\">\n</span><span class=\"code-line\">            <span class=\"token keyword\">let</span> handle <span class=\"token operator\">=</span> app<span class=\"token punctuation\">.</span><span class=\"token function\">handle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line\">            <span class=\"token keyword\">let</span> boxed_handle <span class=\"token operator\">=</span> <span class=\"token class-name\">Box</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span>handle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line\">\n</span><span class=\"code-line\">            <span class=\"token namespace\">thread<span class=\"token punctuation\">::</span></span><span class=\"token function\">spawn</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">move</span> <span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span><span class=\"token closure-punctuation punctuation\">|</span></span> <span class=\"token punctuation\">{</span>\n</span><span class=\"code-line\">                <span class=\"token namespace\">server<span class=\"token punctuation\">::</span></span><span class=\"token function\">init</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>boxed_handle<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line\">            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line\">            <span class=\"token class-name\">Ok</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</span><span class=\"code-line\">        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n</span><span class=\"code-line\">        <span class=\"token punctuation\">.</span><span class=\"token function\">invoke_handler</span><span class=\"token punctuation\">(</span><span class=\"token namespace\">tauri<span class=\"token punctuation\">::</span></span><span class=\"token macro property\">generate_handler!</span><span class=\"token punctuation\">[</span>greet<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n</span><span class=\"code-line\">        <span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token namespace\">tauri<span class=\"token punctuation\">::</span></span><span class=\"token macro property\">generate_context!</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n</span><span class=\"code-line\">        <span class=\"token punctuation\">.</span><span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"error while running tauri application\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</span><span class=\"code-line\"><span class=\"token punctuation\">}</span>\n</span></code></pre>\n<p>In the main method, we uses theÂ <code>tauri::Builder</code>Â struct to customize our\nconfigure and run the Tauri application. TheÂ <code>setup</code>Â method takes a closure\nthat is executed before initializes the Tauri application. It creates a handle\nto the Tauri application using theÂ <code>app.handle()</code>Â method, stores it in a boxed\nvariable, and passes it to theÂ <code>server::init</code>Â function.</p>\n<p>Then, we create a new thread and starts the server usingÂ <code>thread::spawn</code>and\npasses a closure that initializes the Tauri server using theÂ <code>server::init</code>\nfunction. The closure captures ownership of theÂ <code>boxed_handle</code>variable using\ntheÂ <code>move</code>keyword, which moves the boxed handle into the closure. Finally, theÂ \n<code>server::init</code>function takes the boxed handle as a dereferenced pointer\n(using theÂ <code>*</code>operator) and initializes the Tauri server using it. TheÂ <code>unwrap</code>\nmethod is used to panic if there is an error during server initialization. If\nthe closure executed successfully it will returns Ok.</p>\n<p>We have completed our demo, and to ensure it's working correctly, we will run\n<code>npm run tauri dev</code>. This command will launch our application, and we can then\nproceed to test it by sending a GET request to our endpoint located at <code>/api/test</code>.\nIf everything is working fine, we should see the \"Hello World\" message displayed\nin our terminal as a response to the request.</p>\n<p>I hope you enjoyed reading this post and that it has given you some ideas for\nnew features to add to your project.</p>","title":"Setting up Actix Web in a Tauri App","date":"2023-05-08","description":"In this article, we will discuss how to set up an Actix web server with a Tauri application.","keywords":"Tauri, Rust, Desktop apps, Actix, RESTful API","category":"Software Engineering"}},"__N_SSG":true}