<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><title>Basic inverse kinematics in MuJoCo</title><meta name="description" content="Basic IK for Mujoco"/><meta name="author" content="Alexis Fraudita"/><meta name="keywords" content="Robotics, Blog, Portfolio, inverse kinematics, Alexis Fraudita, Python"/><meta property="title" content="Basic inverse kinematics in MuJoCo"/><meta property="url" content="https://alefram.github.io/posts/Basic inverse kinematics in MuJoCo"/><meta property="type" content="website"/><meta name="viewport" content="initial-scale=1.0,  widt h=device-width"/><meta name="robots" content="index, follow"/><meta property="og:url" content="https://alefram.github.io/posts/Basic inverse kinematics in MuJoCo"/><meta property="og:type" content="website"/><meta property="og:title" content="Basic inverse kinematics in MuJoCo"/><meta property="og:description" content="Basic IK for Mujoco"/><meta property="og:image" content="üèì"/><meta name="twitter:card" content="summary_short_image"/><meta property="twitter:domain" content="alefram.github.io"/><meta property="twitter:url" content="https://alefram.github.io/posts/Basic inverse kinematics in MuJoCo"/><meta name="twitter:title" content="Basic inverse kinematics in MuJoCo"/><meta name="twitter:description" content="Basic IK for Mujoco"/><meta name="twitter:image" content="üèì"/><meta name="next-head-count" content="21"/><link rel="canonical" href="https://alefram.github.io/"/><link rel="preconnect" href="https://fonts.gstatic.com"/><meta name="robots" content="index, follow"/><link rel="icon" href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text y=%22.9em%22 font-size=%2290%22&gt;üèì&lt;/text&gt;&lt;/svg&gt;"/><link rel="manifest" href="/site.webmanifest"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" integrity="sha384-Um5gpz1odJg5Z4HAmzPtgZKdTBHZdw8S29IecapCSB31ligYPhHQZMIlWLYQGVoc" crossorigin="anonymous"/><meta name="google-site-verification" content="MpnKrcQvKDGeW2EIhtOow24kp2VahB-vL2hYzqGNC54"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-PHJRD3DMEN"></script><script>
                        window.dataLayer = window.dataLayer || [];
                        function gtag(){dataLayer.push(arguments);}
                        gtag('js', new Date());
                        gtag('config', 'G-PHJRD3DMEN', {
                        page_path: window.location.pathname
                        });
                    </script><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /><link rel="preload" href="/_next/static/css/14558784f20b5e78.css" as="style" crossorigin=""/><link rel="stylesheet" href="/_next/static/css/14558784f20b5e78.css" crossorigin="" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" crossorigin="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-fd8027ecb5121007.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/framework-0c7baedefba6b077.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/main-d5f9a6605aeefdf3.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/_app-d643c2d7f5e04526.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/247-50f18abbe10547c1.js" defer="" crossorigin=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-c9367c3b1434a0ec.js" defer="" crossorigin=""></script><script src="/_next/static/9Hzj17BUmxBfAAt1QDoPv/_buildManifest.js" defer="" crossorigin=""></script><script src="/_next/static/9Hzj17BUmxBfAAt1QDoPv/_ssgManifest.js" defer="" crossorigin=""></script><style data-href="https://fonts.googleapis.com/css2?family=Square+Peg&display=swap">@font-face{font-family:'Square Peg';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/squarepeg/v5/y83eW48Nzw6ZlUHc-phrBDI.woff) format('woff')}@font-face{font-family:'Square Peg';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/squarepeg/v5/y83eW48Nzw6ZlUHc-phrNDnhHVXoBPB56g.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Square Peg';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/squarepeg/v5/y83eW48Nzw6ZlUHc-phrNDjhHVXoBPB56g.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Square Peg';font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/squarepeg/v5/y83eW48Nzw6ZlUHc-phrNDbhHVXoBPA.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style></head><body><div id="__next"><script>!function(){try{var d=document.documentElement,c=d.classList;c.remove('light','dark');var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';c.add('dark')}else{d.style.colorScheme = 'light';c.add('light')}}else if(e){c.add(e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div><nav><div class="flex flex-col md:flex-row p-2 container mx-auto  lg:max-w-screen-lg justify-between md:items-center"><div class="mt-1 flex space-x-2"><a class="text-neutral-900 dark:text-neutral-100 font-bold text-4xl font-square-peg" href="/">üèì AleBlog</a><button><img loading="lazy" width="20" height="20" decoding="async" data-nimg="1" class="my-auto" style="color:transparent" src="/images/dark.svg"/></button></div><div class="mt-2 md:m-2 md:p-4 space-x-4 md:text-center"><a class="text-neutral-900 font-bold hover:underline hover:text-blue-600 font-nunito dark:text-neutral-100 dark:hover:text-blue-300" href="/Projects">Projects</a><a class="text-neutral-900 font-bold hover:underline hover:text-blue-600 font-nunito dark:text-neutral-100 dark:hover:text-blue-300" href="/About">About</a></div></div></nav><main class="mt-10 px-4"><div class="mx-auto max-w-2xl"><h1 class="text-2xl md:text-4xl text-neutral-900 dark:text-neutral-100 font-bold font-nunito">Basic inverse kinematics in MuJoCo</h1><nav class="mt-10 bg-neutral-300 dark:bg-neutral-900 p-4 rounded-lg"><h2 class="font-bold flex items-center justify-between">Table of Contents<button class="text-sm text-gray-500 focus:outline-none">Hide</button></h2><ul class="mt-5 list-inside text-gray-900 dark:text-gray-300 space-y-1"><li class="hover:underline"><a class="flex items-center" href="#what-is-inverse-kinematics"><svg class="text-slate-400 dark:text-slate-600 mr-2" width="3" height="3" viewBox="0 0 3 3"><circle cx="1.5" cy="1.5" r="1.5" fill="currentColor"></circle></svg>What is inverse kinematics</a></li><li class="hover:underline"><a class="flex items-center" href="#inverse-kinematics-algorithms"><svg class="text-slate-400 dark:text-slate-600 mr-2" width="3" height="3" viewBox="0 0 3 3"><circle cx="1.5" cy="1.5" r="1.5" fill="currentColor"></circle></svg>Inverse Kinematics algorithms</a></li><li class="ml-4 hover:underline"><a class="flex items-center" href="#gauss-newton"><svg width="3" height="24" viewBox="0 -9 3 24" class="mr-2 text-slate-400 overflow-visible group-hover:text-slate-600 dark:text-slate-600 dark:group-hover:text-slate-500"><path d="M0 0L3 3L0 6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>Gauss-Newton</a></li><li class="ml-4 hover:underline"><a class="flex items-center" href="#gradient-descent"><svg width="3" height="24" viewBox="0 -9 3 24" class="mr-2 text-slate-400 overflow-visible group-hover:text-slate-600 dark:text-slate-600 dark:group-hover:text-slate-500"><path d="M0 0L3 3L0 6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>Gradient Descent</a></li><li class="ml-4 hover:underline"><a class="flex items-center" href="#levenberg-marquardt"><svg width="3" height="24" viewBox="0 -9 3 24" class="mr-2 text-slate-400 overflow-visible group-hover:text-slate-600 dark:text-slate-600 dark:group-hover:text-slate-500"><path d="M0 0L3 3L0 6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>Levenberg-Marquardt</a></li><li class="hover:underline"><a class="flex items-center" href="#implementation"><svg class="text-slate-400 dark:text-slate-600 mr-2" width="3" height="3" viewBox="0 0 3 3"><circle cx="1.5" cy="1.5" r="1.5" fill="currentColor"></circle></svg>Implementation</a></li><li class="ml-4 hover:underline"><a class="flex items-center" href="#gradient-descent"><svg width="3" height="24" viewBox="0 -9 3 24" class="mr-2 text-slate-400 overflow-visible group-hover:text-slate-600 dark:text-slate-600 dark:group-hover:text-slate-500"><path d="M0 0L3 3L0 6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>Gradient descent</a></li><li class="ml-4 hover:underline"><a class="flex items-center" href="#gauss-newton"><svg width="3" height="24" viewBox="0 -9 3 24" class="mr-2 text-slate-400 overflow-visible group-hover:text-slate-600 dark:text-slate-600 dark:group-hover:text-slate-500"><path d="M0 0L3 3L0 6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>Gauss-Newton</a></li><li class="ml-4 hover:underline"><a class="flex items-center" href="#levenberg-marquardt"><svg width="3" height="24" viewBox="0 -9 3 24" class="mr-2 text-slate-400 overflow-visible group-hover:text-slate-600 dark:text-slate-600 dark:group-hover:text-slate-500"><path d="M0 0L3 3L0 6" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></path></svg>Levenberg-Marquardt</a></li><li class="hover:underline"><a class="flex items-center" href="#simulation"><svg class="text-slate-400 dark:text-slate-600 mr-2" width="3" height="3" viewBox="0 0 3 3"><circle cx="1.5" cy="1.5" r="1.5" fill="currentColor"></circle></svg>Simulation</a></li><li class="hover:underline"><a class="flex items-center" href="#conclusion"><svg class="text-slate-400 dark:text-slate-600 mr-2" width="3" height="3" viewBox="0 0 3 3"><circle cx="1.5" cy="1.5" r="1.5" fill="currentColor"></circle></svg>Conclusion</a></li><li class="hover:underline"><a class="flex items-center" href="#reference"><svg class="text-slate-400 dark:text-slate-600 mr-2" width="3" height="3" viewBox="0 0 3 3"><circle cx="1.5" cy="1.5" r="1.5" fill="currentColor"></circle></svg>Reference</a></li></ul></nav><article class="text-base max-w-2xl mt-10 font-Roboto markdown prose  prose-blue text-neutral-800 dark:text-neutral-400 dark:prose-invert"><p>In my journey exploring the fundamentals of robot manipulation, I was curious
about how to perform simple inverse kinematics. I'm aware that numerous
libraries exist to handle this topic, but I'd like to practice translating the
math/pseudocode into actual implementation, particularly in MuJoCo, which
is my primary simulator for conducting experiments at the moment. Here's what
I discovered:</p>
<h2 id="what-is-inverse-kinematics">What is inverse kinematics</h2>
<p>Imagine you have a six-joint robot manipulator with an end-effector, like a
gripper, at its tip. You want to move this end-effector to a specific point in
3D space to perform a task. To achieve this, you need to determine the exact
joint coordinates required to position the end-effector at your desired point.
This is where inverse kinematics comes into play.</p>
<p>Inverse kinematics is the process of mapping the end-effector's pose
(position and orientation) to the joint coordinates that will achieve that pose.
By using inverse kinematics, you can find the specific joint angles needed to
move the end-effector to your desired point in 3D space.</p>
<p><img src="/images/ik-diagram.svg" alt="ik-diagram"></p>
<p>Given that there are two ways to solve inverse kinematics: the analytical
approach and the numerical approach. The analytical approach involves using the
mathematical model to solve for the joint angles required to achieve a desired
end-effector pose. On the other hand, the numerical approach involves using
iterative calculations to approximate the joint angles using an optimization
algorithm.</p>
<p>In this article I will focus on the numerical approaches that I found.</p>
<h2 id="inverse-kinematics-algorithms">Inverse Kinematics algorithms</h2>
<p>While searching for the most common ways to compute inverse kinematics, I
discovered the master thesis of <strong>Anton Larsson</strong> and <strong>Oskar Gr√∂nlund</strong> titled
"Comparative Analysis of the Inverse Kinematics of a 6-DOF Manipulator". In
this thesis, they discuss the use of the Jacobian to approximate the
relationship between joint angles and desired end-effector position. They
explain three methods for doing this: <strong>Gradient Descent</strong>, <strong>Gauss-Newton</strong>,
and <strong>Levenberg-Marquardt</strong>.</p>
<h3 id="gauss-newton">Gauss-Newton</h3>
<p>The Gauss-Newton algorithm is a extension of a Newton's method for finding a
minimum value of a non-linear function [1]. It starts by defining an initial
guess <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">x_{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> and estimate the next best optimal value denote by <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">x_{n+1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span></span>
using the equation (1).</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right" columnspacing=""><mtr><mtd class="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msub><mi>x</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>x</mi><mi>n</mi></msub><mo>‚àí</mo><mfrac><mrow><msup><mi>f</mi><mo mathvariant="normal" lspace="0em" rspace="0em">‚Ä≤</mo></msup><mo stretchy="false">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><mrow><msup><mi>f</mi><mrow><mo mathvariant="normal">‚Ä≤</mo><mo mathvariant="normal">‚Ä≤</mo></mrow></msup><mo stretchy="false">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow></mfrac></mrow></mstyle></mtd><mtd class="mtr-glue"></mtd><mtd class="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
    x_{n+1} = x_{n} - \frac{f^{\prime}(x_{n})}{f^{\prime\prime}(x_{n})}
\end{align}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.6649em;vertical-align:-1.0824em;"></span><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5824em;"><span style="top:-3.5824em;"><span class="pstrut" style="height:3.4289em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">‚àí</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4289em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6779em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">‚Ä≤‚Ä≤</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">‚Ä≤</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:1.0824em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5824em;"><span style="top:-3.5824em;"><span class="pstrut" style="height:3.4289em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:1.0824em;"><span></span></span></span></span></span></span></span></span></div>
<p>Where <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>f</mi><mo mathvariant="normal" lspace="0em" rspace="0em">‚Ä≤</mo></msup><mo stretchy="false">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f^{\prime}(x_{n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0019em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">‚Ä≤</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span> represents the gradient of the cost
function at the current point <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">x_{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span>, while <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>f</mi><mrow><mo mathvariant="normal">‚Ä≤</mo><mo mathvariant="normal">‚Ä≤</mo></mrow></msup><mo stretchy="false">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f^{\prime\prime}(x_{n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0019em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">‚Ä≤‚Ä≤</span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span> denotes
the second derivative of the cost function at the same point, known as the
"<strong>Hessian matrix</strong>". The Hessian matrix measures how the gradient changes as the
parameters change. This equation updates the current point <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">x_{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> by moving in
a direction that minimizes the cost function, considering both the gradient and
the curvature of the cost function at that point. If you'd like to explore this
technique further, I recommend referring to the thesis by Anton and Oskar for
more detailed information.</p>
<p>The Gauss-Newton method approximates the <strong>Hessian matrix</strong> using the Jacobian
matrix to establish the relationship between joints and end-effector position.
However, in Anton and Oskar's thesis, they utilize the pseudo-inverse of the
Jacobian matrix, as seen in equation (2), instead of the original version.</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right" columnspacing=""><mtr><mtd class="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msup><mi>J</mi><mo lspace="0em" rspace="0em">‚Ä†</mo></msup><mo>=</mo><mo stretchy="false">(</mo><msup><mi>J</mi><mi>T</mi></msup><mi>J</mi><msup><mo stretchy="false">)</mo><mrow><mo>‚àí</mo><mn>1</mn></mrow></msup><msup><mi>J</mi><mi>T</mi></msup></mrow></mstyle></mtd><mtd class="mtr-glue"></mtd><mtd class="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
    J^{\dagger} = (J^{T}J)^{-1}J^{T}
\end{align}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.5591em;vertical-align:-0.5296em;"></span><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0296em;"><span style="top:-3.1304em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">‚Ä†</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">‚àí</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.5296em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0296em;"><span style="top:-3.0296em;"><span class="pstrut" style="height:2.8991em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.5296em;"><span></span></span></span></span></span></span></span></span></div>
<p>Then the equation (1) turns to.</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right" columnspacing=""><mtr><mtd class="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msub><mi>x</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>x</mi><mi>n</mi></msub><mo>‚àí</mo><msup><mi>H</mi><mrow><mo>‚àí</mo><mn>1</mn></mrow></msup><mi mathvariant="normal">‚àá</mi><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>x</mi><mi>n</mi></msub><mo>‚àí</mo><msup><mi>J</mi><mo lspace="0em" rspace="0em">‚Ä†</mo></msup><mi>r</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd class="mtr-glue"></mtd><mtd class="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
    x_{n+1} = x_{n} - H^{-1}\nabla f(x_{n}) = x_{n} - J^{\dagger}r(x)
\end{align}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.5591em;vertical-align:-0.5296em;"></span><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0296em;"><span style="top:-3.1304em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">‚àí</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">‚àí</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord">‚àá</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">‚àí</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8991em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">‚Ä†</span></span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.5296em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0296em;"><span style="top:-3.0296em;"><span class="pstrut" style="height:2.8991em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.5296em;"><span></span></span></span></span></span></span></span></span></div>
<p>In the thesis, they also provides a pseudocode to use.</p>
<pre class="language-latex"><code class="language-latex code-highlight"><span class="code-line">goal_pose = y
</span><span class="code-line">q = current joint angles
</span><span class="code-line">step_size = desired step size
</span><span class="code-line">tolerance = set tolerance
</span><span class="code-line">e = goal_pose - current_pose
</span><span class="code-line">while norm(e) >= tolerance do
</span><span class="code-line">    J = Jacobian(q)
</span><span class="code-line">    J_T = J.transpose()
</span><span class="code-line">    J_pinv = (J_T * J).inv() * J_T
</span><span class="code-line">    delta_q = J_pinv * e
</span><span class="code-line">    q += step_size * delta_q
</span><span class="code-line">    q = check_joint_limits(q)
</span><span class="code-line">    e = goal_pose - ForwardKinematics(q)
</span><span class="code-line">end while
</span></code></pre>
<h3 id="gradient-descent">Gradient Descent</h3>
<p>The gradient descent method, also known as the <strong>Jacobian transpose method</strong>, is
another numerical approach to solving the inverse kinematics optimization
problem. This method solves the problem by iteratively adjusting the joint
angles to reduce the error between the desired and actual end-effector position.</p>
<p>In order to obtain the joint angles, the gradient descent method utilizes the
transpose of the Jacobian matrix to map the difference between the actual and
desired end-effector positions to the angles of the joints [2]. This is
achieved by calculating the gradient using equation (3)</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right" columnspacing=""><mtr><mtd class="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msub><mi>x</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>x</mi><mi>x</mi></msub><mo>‚àí</mo><mi>Œ±</mi><mi mathvariant="normal">‚àá</mi><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>x</mi><mi>n</mi></msub><mo>‚àí</mo><mi>Œ±</mi><msup><mi>J</mi><mi>T</mi></msup><mi>r</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd class="mtr-glue"></mtd><mtd class="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
    x_{n+1} = x_{x} - \alpha \nabla f(x_{n}) = x_{n} - \alpha J^{T}r(x)
\end{align}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.5513em;vertical-align:-0.5257em;"></span><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0257em;"><span style="top:-3.1343em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">‚àí</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Œ±</span><span class="mord">‚àá</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">‚àí</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Œ±</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.5257em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0257em;"><span style="top:-3.0257em;"><span class="pstrut" style="height:2.8913em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.5257em;"><span></span></span></span></span></span></span></span></span></div>
<p>Where <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ±</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Œ±</span></span></span></span></span> is the learning rate that define the size of the step taken into
the direction of the steepest descent during each iteraction [2]. Also is commun
to define this parameter by trial and error.</p>
<pre class="language-latex"><code class="language-latex code-highlight"><span class="code-line">goal_pose = y
</span><span class="code-line">q = current joint angles
</span><span class="code-line">step_size = desired step size
</span><span class="code-line">tolerance = set tolerance
</span><span class="code-line">e = goal_pose - current_pose
</span><span class="code-line">while norm(e) >= tolerance do
</span><span class="code-line">    J = Jacobian(q)
</span><span class="code-line">    J_T = J.transpose()
</span><span class="code-line">    gradient = alpha * J_T * e
</span><span class="code-line">    q += step_size * gradient
</span><span class="code-line">    q = check_joint_limits(q)
</span><span class="code-line">    e = goal_pose - ForwardKinematics(q)
</span><span class="code-line">end while
</span></code></pre>
<h3 id="levenberg-marquardt">Levenberg-Marquardt</h3>
<p>The <strong>Levenberg-Marquardt method</strong>, is a combination of <strong>Gauss-Newton</strong> and
<strong>gradient descent</strong> using the following equation.</p>
<div class="math math-display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right" columnspacing=""><mtr><mtd class="mtr-glue"></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><msub><mi>x</mi><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>x</mi><mi>n</mi></msub><mo>+</mo><mo stretchy="false">(</mo><msup><mi>J</mi><mi>T</mi></msup><mi>J</mi><mo>+</mo><mi>Œª</mi><mi>I</mi><msup><mo stretchy="false">)</mo><mrow><mo>‚àí</mo><mn>1</mn></mrow></msup><msup><mi>J</mi><mi>T</mi></msup><mi>r</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd class="mtr-glue"></mtd><mtd class="mml-eqn-num"></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align}
    x_{n+1} = x_{n} + (J^{T}J + \lambda I)^{-1}J^{T}r(x_{n})
\end{align}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.5513em;vertical-align:-0.5257em;"></span><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0257em;"><span style="top:-3.1343em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">Œª</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">‚àí</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.5257em;"><span></span></span></span></span></span></span></span><span class="tag"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0257em;"><span style="top:-3.0257em;"><span class="pstrut" style="height:2.8913em;"></span><span class="eqn-num"></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.5257em;"><span></span></span></span></span></span></span></span></span></div>
<p>Where <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">x_{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> represents the current value of x at the n-th iteration, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi></mrow><annotation encoding="application/x-tex">J</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.09618em;">J</span></span></span></span></span> is
the Jacobian matrix of the <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span> function, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">r(x_{n})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span> denotes the residual
vector at <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">x_{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">‚Äã</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span>, <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œª</mi></mrow><annotation encoding="application/x-tex">\lambda</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">Œª</span></span></span></span></span> is a <strong>damping</strong> factor used to control the step size,
and <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi></mrow><annotation encoding="application/x-tex">I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span></span> represents the identity matrix.</p>
<p>Similar to <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œ±</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Œ±</span></span></span></span></span>, the parameter <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Œª</mi></mrow><annotation encoding="application/x-tex">\lambda</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">Œª</span></span></span></span></span> is also determined through a
process of trial and error.</p>
<pre class="language-latex"><code class="language-latex code-highlight"><span class="code-line">goal_pose = y
</span><span class="code-line">q = current joint angles
</span><span class="code-line">step_size = desired step size
</span><span class="code-line">tolerance = set tolerance
</span><span class="code-line">e = goal_pose - current_pose
</span><span class="code-line">lambda = damping factor
</span><span class="code-line">
</span><span class="code-line">while norm(e) >= tolerance do
</span><span class="code-line">    J = Jacobian(q)
</span><span class="code-line">    J_T = Jacobian.transpose()
</span><span class="code-line">    J_inv = (J_T * J + lambda * I).inv() * J_T
</span><span class="code-line">    delta_q = J_inv * e
</span><span class="code-line">    q += step_size * delta_q
</span><span class="code-line">    q = check_joint_limits(q)
</span><span class="code-line">    e = goal_pose - ForwardKinematics(q)
</span><span class="code-line">end while
</span></code></pre>
<h2 id="implementation">Implementation</h2>
<p>Seeing that they provide the pseudocode for each algorithm, I have the idea of
trying to re-implement these techniques in <strong>MuJoCo</strong> for practice. Let me
explain how I do it.</p>
<p>First, you need to install the necessary libraries for coding. In this case,
I decided to use the Python bindings of the
<a href="https://mujoco.readthedocs.io/en/stable/python.xml">MuJoCo library</a>.</p>
<pre class="language-python"><code class="language-python code-highlight"><span class="code-line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
</span><span class="code-line"><span class="token keyword">import</span> mujoco
</span><span class="code-line"><span class="token keyword">import</span> mujoco<span class="token punctuation">.</span>viewer <span class="token keyword">as</span> viewer
</span><span class="code-line"><span class="token keyword">import</span> mediapy <span class="token keyword">as</span> media
</span></code></pre>
<p>Then, choose a MuJoCo robot arm model to test our inverse kinematics. In this
case I decided to use the UR5e robot arm from the <strong>mujoco_menangerie</strong>
<a href="https://github.com/google-deepmind/mujoco_menagerie/blob/main/universal_robots_ur5e/README.md">library</a></p>
<pre class="language-python"><code class="language-python code-highlight"><span class="code-line"><span class="token comment">#add path</span>
</span><span class="code-line">xml <span class="token operator">=</span> <span class="token string">"&#x3C;path>/mujoco_menagerie/universal_robots_ur5e/scene.xml"</span>
</span><span class="code-line">model <span class="token operator">=</span> mujoco<span class="token punctuation">.</span>MjModel<span class="token punctuation">.</span>from_xml_path<span class="token punctuation">(</span>xml<span class="token punctuation">)</span>
</span><span class="code-line">data <span class="token operator">=</span> mujoco<span class="token punctuation">.</span>MjData<span class="token punctuation">(</span>model<span class="token punctuation">)</span>
</span><span class="code-line">renderer <span class="token operator">=</span> mujoco<span class="token punctuation">.</span>Renderer<span class="token punctuation">(</span>model<span class="token punctuation">)</span>
</span></code></pre>
<p>I also created a new camera, to get a better view of the robot.</p>
<pre class="language-python"><code class="language-python code-highlight"><span class="code-line">camera <span class="token operator">=</span> mujoco<span class="token punctuation">.</span>MjvCamera<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">mujoco<span class="token punctuation">.</span>mjv_defaultFreeCamera<span class="token punctuation">(</span>model<span class="token punctuation">,</span> camera<span class="token punctuation">)</span>
</span><span class="code-line">camera<span class="token punctuation">.</span>distance <span class="token operator">=</span> <span class="token number">1</span>
</span></code></pre>
<p>One important thing to ensure the correctness of an algorithm is to have a
"test coordinate." To do this, I choosed the position of the joints that give
a good visualization by trial and error and use the "<strong>wrist 3</strong>" link, which is
the last piece of the robot model, as an <strong>end-effector</strong></p>
<pre class="language-python"><code class="language-python code-highlight"><span class="code-line"><span class="token comment">#Put a position of the joints to get a test point</span>
</span><span class="code-line">pi <span class="token operator">=</span> np<span class="token punctuation">.</span>pi
</span><span class="code-line">data<span class="token punctuation">.</span>qpos <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">*</span>pi<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span>pi<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> pi<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">*</span>pi<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token operator">*</span>pi<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">#Initial joint position</span>
</span><span class="code-line">qpos0 <span class="token operator">=</span> data<span class="token punctuation">.</span>qpos<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">#Step the simulation.</span>
</span><span class="code-line">mujoco<span class="token punctuation">.</span>mj_forward<span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">#Use the last piece as an "end effector" to get a test point in cartesian </span>
</span><span class="code-line"><span class="token comment"># coordinates</span>
</span><span class="code-line">target <span class="token operator">=</span> data<span class="token punctuation">.</span>body<span class="token punctuation">(</span><span class="token string">'wrist_3_link'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>xpos
</span><span class="code-line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Target =>"</span><span class="token punctuation">,</span>target<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">#Plot results</span>
</span><span class="code-line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Results"</span><span class="token punctuation">)</span>
</span><span class="code-line">mujoco<span class="token punctuation">.</span>mj_resetDataKeyframe<span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
</span><span class="code-line">mujoco<span class="token punctuation">.</span>mj_forward<span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
</span><span class="code-line">init_point <span class="token operator">=</span> data<span class="token punctuation">.</span>body<span class="token punctuation">(</span><span class="token string">'wrist_3_link'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>xpos<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">renderer<span class="token punctuation">.</span>update_scene<span class="token punctuation">(</span>data<span class="token punctuation">,</span> camera<span class="token punctuation">)</span>
</span><span class="code-line">target_plot <span class="token operator">=</span> renderer<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">data<span class="token punctuation">.</span>qpos <span class="token operator">=</span> qpos0
</span><span class="code-line">mujoco<span class="token punctuation">.</span>mj_forward<span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
</span><span class="code-line">result_point <span class="token operator">=</span> data<span class="token punctuation">.</span>body<span class="token punctuation">(</span><span class="token string">'wrist_3_link'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>xpos<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">renderer<span class="token punctuation">.</span>update_scene<span class="token punctuation">(</span>data<span class="token punctuation">,</span> camera<span class="token punctuation">)</span>
</span><span class="code-line">result_plot <span class="token operator">=</span> renderer<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"initial point =>"</span><span class="token punctuation">,</span> init_point<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Desire point =>"</span><span class="token punctuation">,</span> result_point<span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">images <span class="token operator">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token string">'Initial position'</span><span class="token punctuation">:</span> target_plot<span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token string">' Desire end effector position'</span><span class="token punctuation">:</span> result_plot<span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">media<span class="token punctuation">.</span>show_images<span class="token punctuation">(</span>images<span class="token punctuation">)</span>
</span></code></pre>
<p>And this is what I've got.</p>
<p><img src="/images/test_point.png" alt="test coordinate"></p>
<p>Now let's create the algorithms.</p>
<p>As you can see in the pseudocode, there is something similar among all of them,
which is that they all use the <strong>Jacobian</strong>. Fortunately, MuJoCo provides a method
that allows us to calculate the Jacobian without having to do it manually,
which is called <a href="https://mujoco.readthedocs.io/en/stable/APIreference/APIfunctions.html?highlight=mj_jac#mj-jac"><strong>mj_jac</strong></a>.
It can be a big help in creating these algorithms.</p>
<p>I created a class for the different algorithms to make their use simpler. In
this class, I defined the <strong>check_joint_limits</strong> method in the pseudocode and the
<strong>calculate</strong> method, where I implemented the algorithm using the MuJoCo library and
NumPy.</p>
<p>After implementing the algorithms, I initialized the variables for each one.
These values change a lot depending on the distance from the starting angles,
so I determined the values through the results of Anton&#x26;Oskar thesis and trial
and error to find what works best. However, if you want to experiment with the
parameters, feel free to do so. Finally, I rendered the model and checked if it
works.</p>
<h3 id="gradient-descent">Gradient descent</h3>
<pre class="language-python"><code class="language-python code-highlight"><span class="code-line"><span class="token comment"># Gradient Descent method</span>
</span><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">GradientDescentIK</span><span class="token punctuation">:</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model<span class="token punctuation">,</span> data<span class="token punctuation">,</span> step_size<span class="token punctuation">,</span> tol<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> jacp<span class="token punctuation">,</span> jacr<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        self<span class="token punctuation">.</span>model <span class="token operator">=</span> model
</span><span class="code-line">        self<span class="token punctuation">.</span>data <span class="token operator">=</span> data
</span><span class="code-line">        self<span class="token punctuation">.</span>step_size <span class="token operator">=</span> step_size
</span><span class="code-line">        self<span class="token punctuation">.</span>tol <span class="token operator">=</span> tol
</span><span class="code-line">        self<span class="token punctuation">.</span>alpha <span class="token operator">=</span> alpha
</span><span class="code-line">        self<span class="token punctuation">.</span>jacp <span class="token operator">=</span> jacp
</span><span class="code-line">        self<span class="token punctuation">.</span>jacr <span class="token operator">=</span> jacr
</span><span class="code-line">    
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">check_joint_limits</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token triple-quoted-string string">"""Check if the joints is under or above its limits"""</span>
</span><span class="code-line">        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">            q<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>jnt_range<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
</span><span class="code-line">                       <span class="token builtin">min</span><span class="token punctuation">(</span>q<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>jnt_range<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">#Gradient Descent pseudocode implementation</span>
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">calculate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> goal<span class="token punctuation">,</span> init_q<span class="token punctuation">,</span> body_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token triple-quoted-string string">"""Calculate the desire joints angles for goal"""</span>
</span><span class="code-line">        self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>qpos <span class="token operator">=</span> init_q
</span><span class="code-line">        mujoco<span class="token punctuation">.</span>mj_forward<span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">,</span> self<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
</span><span class="code-line">        current_pose <span class="token operator">=</span> self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>body<span class="token punctuation">(</span>body_id<span class="token punctuation">)</span><span class="token punctuation">.</span>xpos
</span><span class="code-line">        error <span class="token operator">=</span> np<span class="token punctuation">.</span>subtract<span class="token punctuation">(</span>goal<span class="token punctuation">,</span> current_pose<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">while</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">>=</span> self<span class="token punctuation">.</span>tol<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token comment">#calculate jacobian</span>
</span><span class="code-line">            mujoco<span class="token punctuation">.</span>mj_jac<span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">,</span> self<span class="token punctuation">.</span>data<span class="token punctuation">,</span> self<span class="token punctuation">.</span>jacp<span class="token punctuation">,</span> 
</span><span class="code-line">                          self<span class="token punctuation">.</span>jacr<span class="token punctuation">,</span> goal<span class="token punctuation">,</span> body_id<span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token comment">#calculate gradient</span>
</span><span class="code-line">            grad <span class="token operator">=</span> self<span class="token punctuation">.</span>alpha <span class="token operator">*</span> self<span class="token punctuation">.</span>jacp<span class="token punctuation">.</span>T @ error
</span><span class="code-line">            <span class="token comment">#compute next step</span>
</span><span class="code-line">            self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>qpos <span class="token operator">+=</span> self<span class="token punctuation">.</span>step_size <span class="token operator">*</span> grad
</span><span class="code-line">            <span class="token comment">#check joint limits</span>
</span><span class="code-line">            self<span class="token punctuation">.</span>check_joint_limits<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>qpos<span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token comment">#compute forward kinematics</span>
</span><span class="code-line">            mujoco<span class="token punctuation">.</span>mj_forward<span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">,</span> self<span class="token punctuation">.</span>data<span class="token punctuation">)</span> 
</span><span class="code-line">            <span class="token comment">#calculate new error</span>
</span><span class="code-line">            error <span class="token operator">=</span> np<span class="token punctuation">.</span>subtract<span class="token punctuation">(</span>goal<span class="token punctuation">,</span> self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>body<span class="token punctuation">(</span>body_id<span class="token punctuation">)</span><span class="token punctuation">.</span>xpos<span class="token punctuation">)</span>  
</span></code></pre>
<pre class="language-python"><code class="language-python code-highlight"><span class="code-line"><span class="token comment">#Init variables.</span>
</span><span class="code-line">body_id <span class="token operator">=</span> model<span class="token punctuation">.</span>body<span class="token punctuation">(</span><span class="token string">'wrist_3_link'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">id</span>
</span><span class="code-line">jacp <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> model<span class="token punctuation">.</span>nv<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#translation jacobian</span>
</span><span class="code-line">jacr <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> model<span class="token punctuation">.</span>nv<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#rotational jacobian</span>
</span><span class="code-line">goal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.49</span><span class="token punctuation">,</span> <span class="token number">0.13</span><span class="token punctuation">,</span> <span class="token number">0.59</span><span class="token punctuation">]</span>
</span><span class="code-line">step_size <span class="token operator">=</span> <span class="token number">0.5</span>
</span><span class="code-line">tol <span class="token operator">=</span> <span class="token number">0.01</span>
</span><span class="code-line">alpha <span class="token operator">=</span> <span class="token number">0.5</span>
</span><span class="code-line">init_q <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line">ik <span class="token operator">=</span> GradientDescentIK<span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">,</span> step_size<span class="token punctuation">,</span> tol<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> jacp<span class="token punctuation">,</span> jacr<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">#Get desire point</span>
</span><span class="code-line">mujoco<span class="token punctuation">.</span>mj_resetDataKeyframe<span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">#reset qpos to initial value</span>
</span><span class="code-line">ik<span class="token punctuation">.</span>calculate<span class="token punctuation">(</span>goal<span class="token punctuation">,</span> init_q<span class="token punctuation">,</span> body_id<span class="token punctuation">)</span> <span class="token comment">#calculate the q angles</span>
</span><span class="code-line">
</span><span class="code-line">result <span class="token operator">=</span> data<span class="token punctuation">.</span>qpos<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">#Plot results</span>
</span><span class="code-line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Results"</span><span class="token punctuation">)</span>
</span><span class="code-line">data<span class="token punctuation">.</span>qpos <span class="token operator">=</span> qpos0
</span><span class="code-line">mujoco<span class="token punctuation">.</span>mj_forward<span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
</span><span class="code-line">renderer<span class="token punctuation">.</span>update_scene<span class="token punctuation">(</span>data<span class="token punctuation">,</span> camera<span class="token punctuation">)</span>
</span><span class="code-line">target_plot <span class="token operator">=</span> renderer<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">data<span class="token punctuation">.</span>qpos <span class="token operator">=</span> result
</span><span class="code-line">mujoco<span class="token punctuation">.</span>mj_forward<span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
</span><span class="code-line">result_point <span class="token operator">=</span> data<span class="token punctuation">.</span>body<span class="token punctuation">(</span><span class="token string">'wrist_3_link'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>xpos
</span><span class="code-line">renderer<span class="token punctuation">.</span>update_scene<span class="token punctuation">(</span>data<span class="token punctuation">,</span> camera<span class="token punctuation">)</span>
</span><span class="code-line">result_plot <span class="token operator">=</span> renderer<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"testing point =>"</span><span class="token punctuation">,</span> target<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Gradient Descent result =>"</span><span class="token punctuation">,</span> result_point<span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">images <span class="token operator">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token string">'Testing point'</span><span class="token punctuation">:</span> target_plot<span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token string">'Gradient Descent result'</span><span class="token punctuation">:</span> result_plot<span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">media<span class="token punctuation">.</span>show_images<span class="token punctuation">(</span>images<span class="token punctuation">)</span>
</span></code></pre>
<p><img src="/images/gdresult.png" alt="gd-result-render" title="Gradient Descent result"></p>
<h3 id="gauss-newton">Gauss-Newton</h3>
<pre class="language-python"><code class="language-python code-highlight"><span class="code-line"><span class="token comment"># Gauss-Newton method</span>
</span><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">GaussNewtonIK</span><span class="token punctuation">:</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model<span class="token punctuation">,</span> data<span class="token punctuation">,</span> step_size<span class="token punctuation">,</span> tol<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> jacp<span class="token punctuation">,</span> jacr<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        self<span class="token punctuation">.</span>model <span class="token operator">=</span> model
</span><span class="code-line">        self<span class="token punctuation">.</span>data <span class="token operator">=</span> data
</span><span class="code-line">        self<span class="token punctuation">.</span>step_size <span class="token operator">=</span> step_size
</span><span class="code-line">        self<span class="token punctuation">.</span>tol <span class="token operator">=</span> tol
</span><span class="code-line">        self<span class="token punctuation">.</span>alpha <span class="token operator">=</span> alpha
</span><span class="code-line">        self<span class="token punctuation">.</span>jacp <span class="token operator">=</span> jacp
</span><span class="code-line">        self<span class="token punctuation">.</span>jacr <span class="token operator">=</span> jacr
</span><span class="code-line">    
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">check_joint_limits</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token triple-quoted-string string">"""Check if the joints is under or above its limits"""</span>
</span><span class="code-line">        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">            q<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>jnt_range<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
</span><span class="code-line">                       <span class="token builtin">min</span><span class="token punctuation">(</span>q<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>jnt_range<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="token comment"># Gauss-Newton pseudocode implementation</span>
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">calculate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> goal<span class="token punctuation">,</span> init_q<span class="token punctuation">,</span> body_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token triple-quoted-string string">"""Calculate the desire joints angles for goal"""</span>
</span><span class="code-line">        self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>qpos <span class="token operator">=</span> init_q
</span><span class="code-line">        mujoco<span class="token punctuation">.</span>mj_forward<span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">,</span> self<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
</span><span class="code-line">        current_pose <span class="token operator">=</span> self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>body<span class="token punctuation">(</span>body_id<span class="token punctuation">)</span><span class="token punctuation">.</span>xpos
</span><span class="code-line">        error <span class="token operator">=</span> np<span class="token punctuation">.</span>subtract<span class="token punctuation">(</span>goal<span class="token punctuation">,</span> current_pose<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">while</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">>=</span> self<span class="token punctuation">.</span>tol<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token comment">#calculate jacobian</span>
</span><span class="code-line">            mujoco<span class="token punctuation">.</span>mj_jac<span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">,</span> self<span class="token punctuation">.</span>data<span class="token punctuation">,</span> self<span class="token punctuation">.</span>jacp<span class="token punctuation">,</span> 
</span><span class="code-line">                          self<span class="token punctuation">.</span>jacr<span class="token punctuation">,</span> goal<span class="token punctuation">,</span> body_id<span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token comment">#calculate delta of joint q</span>
</span><span class="code-line">            product <span class="token operator">=</span> self<span class="token punctuation">.</span>jacp<span class="token punctuation">.</span>T @ self<span class="token punctuation">.</span>jacp
</span><span class="code-line">            
</span><span class="code-line">            <span class="token keyword">if</span> np<span class="token punctuation">.</span>isclose<span class="token punctuation">(</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>det<span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">                j_inv <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>pinv<span class="token punctuation">(</span>product<span class="token punctuation">)</span> @ self<span class="token punctuation">.</span>jacp<span class="token punctuation">.</span>T
</span><span class="code-line">            <span class="token keyword">else</span><span class="token punctuation">:</span>
</span><span class="code-line">                j_inv <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>inv<span class="token punctuation">(</span>product<span class="token punctuation">)</span> @ self<span class="token punctuation">.</span>jacp<span class="token punctuation">.</span>T
</span><span class="code-line">            
</span><span class="code-line">            delta_q <span class="token operator">=</span> j_inv @ error
</span><span class="code-line">            <span class="token comment">#compute next step</span>
</span><span class="code-line">            self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>qpos <span class="token operator">+=</span> self<span class="token punctuation">.</span>step_size <span class="token operator">*</span> delta_q
</span><span class="code-line">            <span class="token comment">#check limits</span>
</span><span class="code-line">            self<span class="token punctuation">.</span>check_joint_limits<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>qpos<span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token comment">#compute forward kinematics</span>
</span><span class="code-line">            mujoco<span class="token punctuation">.</span>mj_forward<span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">,</span> self<span class="token punctuation">.</span>data<span class="token punctuation">)</span> 
</span><span class="code-line">            <span class="token comment">#calculate new error</span>
</span><span class="code-line">            error <span class="token operator">=</span> np<span class="token punctuation">.</span>subtract<span class="token punctuation">(</span>goal<span class="token punctuation">,</span> self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>body<span class="token punctuation">(</span>body_id<span class="token punctuation">)</span><span class="token punctuation">.</span>xpos<span class="token punctuation">)</span> 
</span></code></pre>
<pre class="language-python"><code class="language-python code-highlight"><span class="code-line">
</span><span class="code-line"><span class="token comment">#Init variables.</span>
</span><span class="code-line">body_id <span class="token operator">=</span> model<span class="token punctuation">.</span>body<span class="token punctuation">(</span><span class="token string">'wrist_3_link'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">id</span>
</span><span class="code-line">jacp <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> model<span class="token punctuation">.</span>nv<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#translation jacobian</span>
</span><span class="code-line">jacr <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> model<span class="token punctuation">.</span>nv<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#rotational jacobian</span>
</span><span class="code-line">goal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.49</span><span class="token punctuation">,</span> <span class="token number">0.13</span><span class="token punctuation">,</span> <span class="token number">0.59</span><span class="token punctuation">]</span>
</span><span class="code-line">step_size <span class="token operator">=</span> <span class="token number">0.5</span>
</span><span class="code-line">tol <span class="token operator">=</span> <span class="token number">0.01</span>
</span><span class="code-line">alpha <span class="token operator">=</span> <span class="token number">0.5</span>
</span><span class="code-line">init_q <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line">ik <span class="token operator">=</span> GaussNewtonIK<span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">,</span> step_size<span class="token punctuation">,</span> tol<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> jacp<span class="token punctuation">,</span> jacr<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">#Get desire point</span>
</span><span class="code-line">mujoco<span class="token punctuation">.</span>mj_resetDataKeyframe<span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">#reset qpos to initial value</span>
</span><span class="code-line">ik<span class="token punctuation">.</span>calculate<span class="token punctuation">(</span>goal<span class="token punctuation">,</span> init_q<span class="token punctuation">,</span> body_id<span class="token punctuation">)</span> <span class="token comment">#calculate the qpos</span>
</span><span class="code-line">
</span><span class="code-line">result <span class="token operator">=</span> data<span class="token punctuation">.</span>qpos<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">#Plot results</span>
</span><span class="code-line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Results"</span><span class="token punctuation">)</span>
</span><span class="code-line">data<span class="token punctuation">.</span>qpos <span class="token operator">=</span> qpos0
</span><span class="code-line">mujoco<span class="token punctuation">.</span>mj_forward<span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
</span><span class="code-line">renderer<span class="token punctuation">.</span>update_scene<span class="token punctuation">(</span>data<span class="token punctuation">,</span> camera<span class="token punctuation">)</span>
</span><span class="code-line">target_plot <span class="token operator">=</span> renderer<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">data<span class="token punctuation">.</span>qpos <span class="token operator">=</span> result
</span><span class="code-line">mujoco<span class="token punctuation">.</span>mj_forward<span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
</span><span class="code-line">result_point <span class="token operator">=</span> data<span class="token punctuation">.</span>body<span class="token punctuation">(</span><span class="token string">'wrist_3_link'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>xpos
</span><span class="code-line">renderer<span class="token punctuation">.</span>update_scene<span class="token punctuation">(</span>data<span class="token punctuation">,</span> camera<span class="token punctuation">)</span>
</span><span class="code-line">result_plot <span class="token operator">=</span> renderer<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"testing point =>"</span><span class="token punctuation">,</span> target<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Gauss-Newton result =>"</span><span class="token punctuation">,</span> result_point<span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">images <span class="token operator">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token string">'Testing point'</span><span class="token punctuation">:</span> target_plot<span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token string">'Gauss-Newton result'</span><span class="token punctuation">:</span> result_plot<span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">media<span class="token punctuation">.</span>show_images<span class="token punctuation">(</span>images<span class="token punctuation">)</span>
</span></code></pre>
<p><img src="/images/gnresult.png" alt="gn-result-render" title="Gradient Descent result"></p>
<h3 id="levenberg-marquardt">Levenberg-Marquardt</h3>
<pre class="language-python"><code class="language-python code-highlight"><span class="code-line"><span class="token comment">#Levenberg-Marquardt method</span>
</span><span class="code-line"><span class="token keyword">class</span> <span class="token class-name">LevenbegMarquardtIK</span><span class="token punctuation">:</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model<span class="token punctuation">,</span> data<span class="token punctuation">,</span> step_size<span class="token punctuation">,</span> tol<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> jacp<span class="token punctuation">,</span> jacr<span class="token punctuation">,</span> damping<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        self<span class="token punctuation">.</span>model <span class="token operator">=</span> model
</span><span class="code-line">        self<span class="token punctuation">.</span>data <span class="token operator">=</span> data
</span><span class="code-line">        self<span class="token punctuation">.</span>step_size <span class="token operator">=</span> step_size
</span><span class="code-line">        self<span class="token punctuation">.</span>tol <span class="token operator">=</span> tol
</span><span class="code-line">        self<span class="token punctuation">.</span>alpha <span class="token operator">=</span> alpha
</span><span class="code-line">        self<span class="token punctuation">.</span>jacp <span class="token operator">=</span> jacp
</span><span class="code-line">        self<span class="token punctuation">.</span>jacr <span class="token operator">=</span> jacr
</span><span class="code-line">        self<span class="token punctuation">.</span>damping <span class="token operator">=</span> damping
</span><span class="code-line">    
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">check_joint_limits</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token triple-quoted-string string">"""Check if the joints is under or above its limits"""</span>
</span><span class="code-line">        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">            q<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>jnt_range<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
</span><span class="code-line">                       <span class="token builtin">min</span><span class="token punctuation">(</span>q<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>jnt_range<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">    <span class="token comment">#Levenberg-Marquardt pseudocode implementation</span>
</span><span class="code-line">    <span class="token keyword">def</span> <span class="token function">calculate</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> goal<span class="token punctuation">,</span> init_q<span class="token punctuation">,</span> body_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token triple-quoted-string string">"""Calculate the desire joints angles for goal"""</span>
</span><span class="code-line">        self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>qpos <span class="token operator">=</span> init_q
</span><span class="code-line">        mujoco<span class="token punctuation">.</span>mj_forward<span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">,</span> self<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
</span><span class="code-line">        current_pose <span class="token operator">=</span> self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>body<span class="token punctuation">(</span>body_id<span class="token punctuation">)</span><span class="token punctuation">.</span>xpos
</span><span class="code-line">        error <span class="token operator">=</span> np<span class="token punctuation">.</span>subtract<span class="token punctuation">(</span>goal<span class="token punctuation">,</span> current_pose<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">while</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">>=</span> self<span class="token punctuation">.</span>tol<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">            <span class="token comment">#calculate jacobian</span>
</span><span class="code-line">            mujoco<span class="token punctuation">.</span>mj_jac<span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">,</span> self<span class="token punctuation">.</span>data<span class="token punctuation">,</span> self<span class="token punctuation">.</span>jacp<span class="token punctuation">,</span> self<span class="token punctuation">.</span>jacr<span class="token punctuation">,</span> goal<span class="token punctuation">,</span> body_id<span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token comment">#calculate delta of joint q</span>
</span><span class="code-line">            n <span class="token operator">=</span> self<span class="token punctuation">.</span>jacp<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
</span><span class="code-line">            I <span class="token operator">=</span> np<span class="token punctuation">.</span>identity<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
</span><span class="code-line">            product <span class="token operator">=</span> self<span class="token punctuation">.</span>jacp<span class="token punctuation">.</span>T @ self<span class="token punctuation">.</span>jacp <span class="token operator">+</span> self<span class="token punctuation">.</span>damping <span class="token operator">*</span> I
</span><span class="code-line">            
</span><span class="code-line">            <span class="token keyword">if</span> np<span class="token punctuation">.</span>isclose<span class="token punctuation">(</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>det<span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">                j_inv <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>pinv<span class="token punctuation">(</span>product<span class="token punctuation">)</span> @ self<span class="token punctuation">.</span>jacp<span class="token punctuation">.</span>T
</span><span class="code-line">            <span class="token keyword">else</span><span class="token punctuation">:</span>
</span><span class="code-line">                j_inv <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>inv<span class="token punctuation">(</span>product<span class="token punctuation">)</span> @ self<span class="token punctuation">.</span>jacp<span class="token punctuation">.</span>T
</span><span class="code-line">            
</span><span class="code-line">            delta_q <span class="token operator">=</span> j_inv @ error
</span><span class="code-line">            <span class="token comment">#compute next step</span>
</span><span class="code-line">            self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>qpos <span class="token operator">+=</span> self<span class="token punctuation">.</span>step_size <span class="token operator">*</span> delta_q
</span><span class="code-line">            <span class="token comment">#check limits</span>
</span><span class="code-line">            self<span class="token punctuation">.</span>check_joint_limits<span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>qpos<span class="token punctuation">)</span>
</span><span class="code-line">            <span class="token comment">#compute forward kinematics</span>
</span><span class="code-line">            mujoco<span class="token punctuation">.</span>mj_forward<span class="token punctuation">(</span>self<span class="token punctuation">.</span>model<span class="token punctuation">,</span> self<span class="token punctuation">.</span>data<span class="token punctuation">)</span> 
</span><span class="code-line">            <span class="token comment">#calculate new error</span>
</span><span class="code-line">            error <span class="token operator">=</span> np<span class="token punctuation">.</span>subtract<span class="token punctuation">(</span>goal<span class="token punctuation">,</span> self<span class="token punctuation">.</span>data<span class="token punctuation">.</span>body<span class="token punctuation">(</span>body_id<span class="token punctuation">)</span><span class="token punctuation">.</span>xpos<span class="token punctuation">)</span>  
</span></code></pre>
<pre class="language-python"><code class="language-python code-highlight"><span class="code-line"><span class="token comment">#Init variables.</span>
</span><span class="code-line">body_id <span class="token operator">=</span> model<span class="token punctuation">.</span>body<span class="token punctuation">(</span><span class="token string">'wrist_3_link'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">id</span>
</span><span class="code-line">jacp <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> model<span class="token punctuation">.</span>nv<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#translation jacobian</span>
</span><span class="code-line">jacr <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> model<span class="token punctuation">.</span>nv<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#rotational jacobian</span>
</span><span class="code-line">goal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.49</span><span class="token punctuation">,</span> <span class="token number">0.13</span><span class="token punctuation">,</span> <span class="token number">0.59</span><span class="token punctuation">]</span>
</span><span class="code-line">step_size <span class="token operator">=</span> <span class="token number">0.5</span>
</span><span class="code-line">tol <span class="token operator">=</span> <span class="token number">0.01</span>
</span><span class="code-line">alpha <span class="token operator">=</span> <span class="token number">0.5</span>
</span><span class="code-line">init_q <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span>
</span><span class="code-line">damping <span class="token operator">=</span> <span class="token number">0.15</span>
</span><span class="code-line">
</span><span class="code-line">ik <span class="token operator">=</span> LevenbegMarquardtIK<span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">,</span> step_size<span class="token punctuation">,</span> tol<span class="token punctuation">,</span> alpha<span class="token punctuation">,</span> jacp<span class="token punctuation">,</span> jacr<span class="token punctuation">,</span> damping<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">#Get desire point</span>
</span><span class="code-line">mujoco<span class="token punctuation">.</span>mj_resetDataKeyframe<span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">#reset qpos to initial value</span>
</span><span class="code-line">ik<span class="token punctuation">.</span>calculate<span class="token punctuation">(</span>goal<span class="token punctuation">,</span> init_q<span class="token punctuation">,</span> body_id<span class="token punctuation">)</span> <span class="token comment">#calculate the qpos</span>
</span><span class="code-line">
</span><span class="code-line">result <span class="token operator">=</span> data<span class="token punctuation">.</span>qpos<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">#Plot results</span>
</span><span class="code-line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Results"</span><span class="token punctuation">)</span>
</span><span class="code-line">data<span class="token punctuation">.</span>qpos <span class="token operator">=</span> qpos0
</span><span class="code-line">mujoco<span class="token punctuation">.</span>mj_forward<span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
</span><span class="code-line">renderer<span class="token punctuation">.</span>update_scene<span class="token punctuation">(</span>data<span class="token punctuation">,</span> camera<span class="token punctuation">)</span>
</span><span class="code-line">target_plot <span class="token operator">=</span> renderer<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">data<span class="token punctuation">.</span>qpos <span class="token operator">=</span> result
</span><span class="code-line">mujoco<span class="token punctuation">.</span>mj_forward<span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
</span><span class="code-line">result_point <span class="token operator">=</span> data<span class="token punctuation">.</span>body<span class="token punctuation">(</span><span class="token string">'wrist_3_link'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>xpos
</span><span class="code-line">renderer<span class="token punctuation">.</span>update_scene<span class="token punctuation">(</span>data<span class="token punctuation">,</span> camera<span class="token punctuation">)</span>
</span><span class="code-line">result_plot <span class="token operator">=</span> renderer<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"testing point =>"</span><span class="token punctuation">,</span> target<span class="token punctuation">)</span>
</span><span class="code-line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Levenberg-Marquardt result =>"</span><span class="token punctuation">,</span> result_point<span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">images <span class="token operator">=</span> <span class="token punctuation">{</span>
</span><span class="code-line">    <span class="token string">'Testing point'</span><span class="token punctuation">:</span> target_plot<span class="token punctuation">,</span>
</span><span class="code-line">    <span class="token string">'Levenberg-Marquardt result'</span><span class="token punctuation">:</span> result_plot<span class="token punctuation">,</span>
</span><span class="code-line"><span class="token punctuation">}</span>
</span><span class="code-line">
</span><span class="code-line">media<span class="token punctuation">.</span>show_images<span class="token punctuation">(</span>images<span class="token punctuation">)</span>
</span></code></pre>
<p><img src="/images/lkresult.png" alt="lk-result-render" title="Gradient Descent result"></p>
<h2 id="simulation">Simulation</h2>
<p>Let's try to simulate this movement. To understand how to implement it, I based
on the <a href="https://github.com/kevinzakka/mjctrl">mjctrl</a> repository from Kevin Zakka,
where he explains clear and pedagogical implementations of robotics controllers,
and by referencing the Mujoco
<a href="https://github.com/google-deepmind/mujoco?tab=readme-ov-file#getting-started">colab</a>
examples to render the simulations.</p>
<p>I implemented this code in a Jupyter notebook, and to visualize my robot, I
render a video of it. First, I set up the video parameters so that the video
can run for 4 seconds.</p>
<pre class="language-python"><code class="language-python code-highlight"><span class="code-line"><span class="token comment">#Video setup</span>
</span><span class="code-line"><span class="token keyword">import</span> mediapy <span class="token keyword">as</span> media
</span><span class="code-line">
</span><span class="code-line">DURATION <span class="token operator">=</span> <span class="token number">4</span> <span class="token comment">#(seconds)</span>
</span><span class="code-line">FRAMERATE <span class="token operator">=</span> <span class="token number">60</span> <span class="token comment">#(Hz)</span>
</span><span class="code-line">frames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</span></code></pre>
<p>Then, I reset the model data, initialize the parameters, and obtain the initial
error for the simulation. In this case, I used the <strong>Levenberg-Marquardt</strong> method.</p>
<pre class="language-python"><code class="language-python code-highlight"><span class="code-line"><span class="token comment">#Reset state and time</span>
</span><span class="code-line">mujoco<span class="token punctuation">.</span>mj_resetData<span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">#Init parameters</span>
</span><span class="code-line">jacp <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> model<span class="token punctuation">.</span>nv<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#translation jacobian</span>
</span><span class="code-line">jacr <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> model<span class="token punctuation">.</span>nv<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#rotational jacobian</span>
</span><span class="code-line">step_size <span class="token operator">=</span> <span class="token number">0.5</span>
</span><span class="code-line">tol <span class="token operator">=</span> <span class="token number">0.01</span>
</span><span class="code-line">alpha <span class="token operator">=</span> <span class="token number">0.5</span>
</span><span class="code-line">damping <span class="token operator">=</span> <span class="token number">0.15</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">#Get error.</span>
</span><span class="code-line">end_effector_id <span class="token operator">=</span> model<span class="token punctuation">.</span>body<span class="token punctuation">(</span><span class="token string">'wrist_3_link'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token comment">#"End-effector we wish to control.</span>
</span><span class="code-line">current_pose <span class="token operator">=</span> data<span class="token punctuation">.</span>body<span class="token punctuation">(</span>end_effector_id<span class="token punctuation">)</span><span class="token punctuation">.</span>xpos <span class="token comment">#Current pose</span>
</span><span class="code-line">
</span><span class="code-line">goal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.49</span><span class="token punctuation">,</span> <span class="token number">0.13</span><span class="token punctuation">,</span> <span class="token number">0.59</span><span class="token punctuation">]</span> <span class="token comment">#Desire position</span>
</span><span class="code-line">
</span><span class="code-line">error <span class="token operator">=</span> np<span class="token punctuation">.</span>subtract<span class="token punctuation">(</span>goal<span class="token punctuation">,</span> current_pose<span class="token punctuation">)</span> <span class="token comment">#Init Error</span>
</span></code></pre>
<p>I implemented the algorithm into a loop during the "DURATION" of the video,
calculating and updating inverse kinematics on each step frame. The difference
between this simulation and the last class implementations is the <strong>mj_step</strong>
method, which integrates in time and advances the simulation, applying forward
kinematics. Finally, I rendered and saved frames and displayed them using the
<strong>MediaPy library</strong>.</p>
<pre class="language-python"><code class="language-python code-highlight"><span class="code-line"><span class="token comment">#Simulate</span>
</span><span class="code-line"><span class="token keyword">while</span> data<span class="token punctuation">.</span>time <span class="token operator">&#x3C;</span> DURATION<span class="token punctuation">:</span>
</span><span class="code-line">       
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">>=</span> tol<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token comment">#Calculate jacobian</span>
</span><span class="code-line">        mujoco<span class="token punctuation">.</span>mj_jac<span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">,</span> jacp<span class="token punctuation">,</span> jacr<span class="token punctuation">,</span> goal<span class="token punctuation">,</span> end_effector_id<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token comment">#Calculate delta of joint q</span>
</span><span class="code-line">        n <span class="token operator">=</span> jacp<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
</span><span class="code-line">        I <span class="token operator">=</span> np<span class="token punctuation">.</span>identity<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
</span><span class="code-line">        product <span class="token operator">=</span> jacp<span class="token punctuation">.</span>T @ jacp <span class="token operator">+</span> damping <span class="token operator">*</span> I
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">if</span> np<span class="token punctuation">.</span>isclose<span class="token punctuation">(</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>det<span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">            j_inv <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>pinv<span class="token punctuation">(</span>product<span class="token punctuation">)</span> @ jacp<span class="token punctuation">.</span>T
</span><span class="code-line">        <span class="token keyword">else</span><span class="token punctuation">:</span>
</span><span class="code-line">            j_inv <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>inv<span class="token punctuation">(</span>product<span class="token punctuation">)</span> @ jacp<span class="token punctuation">.</span>T
</span><span class="code-line">
</span><span class="code-line">        delta_q <span class="token operator">=</span> j_inv @ error
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment">#Compute next step</span>
</span><span class="code-line">        q <span class="token operator">=</span> data<span class="token punctuation">.</span>qpos<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        q <span class="token operator">+=</span> step_size <span class="token operator">*</span> delta_q
</span><span class="code-line">        
</span><span class="code-line">        <span class="token comment">#Check limits</span>
</span><span class="code-line">        check_joint_limits<span class="token punctuation">(</span>data<span class="token punctuation">.</span>qpos<span class="token punctuation">)</span>
</span><span class="code-line">        
</span><span class="code-line">        <span class="token comment">#Set control signal</span>
</span><span class="code-line">        data<span class="token punctuation">.</span>ctrl <span class="token operator">=</span> q
</span><span class="code-line">        <span class="token comment">#Step the simulation.</span>
</span><span class="code-line">        mujoco<span class="token punctuation">.</span>mj_step<span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">        error <span class="token operator">=</span> np<span class="token punctuation">.</span>subtract<span class="token punctuation">(</span>goal<span class="token punctuation">,</span> data<span class="token punctuation">.</span>body<span class="token punctuation">(</span>end_effector_id<span class="token punctuation">)</span><span class="token punctuation">.</span>xpos<span class="token punctuation">)</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="token comment">#Render and save frames.</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>frames<span class="token punctuation">)</span> <span class="token operator">&#x3C;</span> data<span class="token punctuation">.</span>time <span class="token operator">*</span> FRAMERATE<span class="token punctuation">:</span>
</span><span class="code-line">        renderer<span class="token punctuation">.</span>update_scene<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
</span><span class="code-line">        pixels <span class="token operator">=</span> renderer<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        frames<span class="token punctuation">.</span>append<span class="token punctuation">(</span>pixels<span class="token punctuation">)</span>
</span><span class="code-line">        
</span><span class="code-line"><span class="token comment">#Display video.</span>
</span><span class="code-line">media<span class="token punctuation">.</span>show_video<span class="token punctuation">(</span>frames<span class="token punctuation">,</span> fps<span class="token operator">=</span>FRAMERATE<span class="token punctuation">)</span>
</span></code></pre>
<p>And this was the final result.</p>
<p><img src="/images/robot.gif" alt="robot"></p>
<p>From here you can implement a lot of stuff, like creating a circle similar to
<strong>mjctrl</strong> examples.</p>
<p><img src="/images/robotCircle.gif" alt="robot circle"></p>
<p>Here is a full code implementation.</p>
<pre class="language-python"><code class="language-python code-highlight"><span class="code-line"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
</span><span class="code-line"><span class="token keyword">import</span> mujoco
</span><span class="code-line"><span class="token keyword">import</span> mujoco<span class="token punctuation">.</span>viewer <span class="token keyword">as</span> viewer
</span><span class="code-line"><span class="token keyword">import</span> mediapy <span class="token keyword">as</span> media
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">#Video Setup</span>
</span><span class="code-line">DURATION <span class="token operator">=</span> <span class="token number">4</span> <span class="token comment">#(seconds)</span>
</span><span class="code-line">FRAMERATE <span class="token operator">=</span> <span class="token number">60</span> <span class="token comment">#(Hz)</span>
</span><span class="code-line">frames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">#Reset state and time.</span>
</span><span class="code-line">mujoco<span class="token punctuation">.</span>mj_resetData<span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">#Init position.</span>
</span><span class="code-line"><span class="token comment"># pi = np.pi</span>
</span><span class="code-line"><span class="token comment"># data.qpos = [3*pi/2, -pi/2, pi/2, 3*pi/2, 3*pi/2, 0] #ENABLE if you want test circle</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">#Init parameters</span>
</span><span class="code-line">jacp <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> model<span class="token punctuation">.</span>nv<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#translation jacobian</span>
</span><span class="code-line">jacr <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> model<span class="token punctuation">.</span>nv<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#rotational jacobian</span>
</span><span class="code-line">step_size <span class="token operator">=</span> <span class="token number">0.5</span>
</span><span class="code-line">tol <span class="token operator">=</span> <span class="token number">0.01</span>
</span><span class="code-line">alpha <span class="token operator">=</span> <span class="token number">0.5</span>
</span><span class="code-line">damping <span class="token operator">=</span> <span class="token number">0.15</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">#Get error.</span>
</span><span class="code-line">end_effector_id <span class="token operator">=</span> model<span class="token punctuation">.</span>body<span class="token punctuation">(</span><span class="token string">'wrist_3_link'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token comment">#"End-effector we wish to control.</span>
</span><span class="code-line">current_pose <span class="token operator">=</span> data<span class="token punctuation">.</span>body<span class="token punctuation">(</span>end_effector_id<span class="token punctuation">)</span><span class="token punctuation">.</span>xpos <span class="token comment">#Current pose</span>
</span><span class="code-line">
</span><span class="code-line">goal <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0.49</span><span class="token punctuation">,</span> <span class="token number">0.13</span><span class="token punctuation">,</span> <span class="token number">0.59</span><span class="token punctuation">]</span> <span class="token comment">#Desire position</span>
</span><span class="code-line">
</span><span class="code-line">error <span class="token operator">=</span> np<span class="token punctuation">.</span>subtract<span class="token punctuation">(</span>goal<span class="token punctuation">,</span> current_pose<span class="token punctuation">)</span> <span class="token comment">#Init Error</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">def</span> <span class="token function">check_joint_limits</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token triple-quoted-string string">"""Check if the joints is under or above its limits"""</span>
</span><span class="code-line">    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        q<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>jnt_range<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token punctuation">(</span>q<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> model<span class="token punctuation">.</span>jnt_range<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token keyword">def</span> <span class="token function">circle</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">,</span> r<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">,</span> h<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">,</span> k<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">:</span>
</span><span class="code-line">    <span class="token triple-quoted-string string">"""Return the (x, y) coordinates of a circle with radius r centered at (h, k)
</span></span><span class="code-line"><span class="token triple-quoted-string string">    as a function of time t and frequency f."""</span>
</span><span class="code-line">    x <span class="token operator">=</span> r <span class="token operator">*</span> np<span class="token punctuation">.</span>cos<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi <span class="token operator">*</span> f <span class="token operator">*</span> t<span class="token punctuation">)</span> <span class="token operator">+</span> h
</span><span class="code-line">    y <span class="token operator">=</span> r <span class="token operator">*</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>pi <span class="token operator">*</span> f <span class="token operator">*</span> t<span class="token punctuation">)</span> <span class="token operator">+</span> k
</span><span class="code-line">    z <span class="token operator">=</span> <span class="token number">0.5</span>
</span><span class="code-line">    <span class="token keyword">return</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">]</span><span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line"><span class="token comment">#Simulate</span>
</span><span class="code-line"><span class="token keyword">while</span> data<span class="token punctuation">.</span>time <span class="token operator">&#x3C;</span> DURATION<span class="token punctuation">:</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="token comment"># goal = circle(data.time, 0.1, 0.5, 0.0, 0.5) #ENABLE to test circle.</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">>=</span> tol<span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">        <span class="token comment">#Calculate jacobian</span>
</span><span class="code-line">        mujoco<span class="token punctuation">.</span>mj_jac<span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">,</span> jacp<span class="token punctuation">,</span> jacr<span class="token punctuation">,</span> goal<span class="token punctuation">,</span> end_effector_id<span class="token punctuation">)</span>
</span><span class="code-line">        <span class="token comment">#Calculate delta of joint q</span>
</span><span class="code-line">        n <span class="token operator">=</span> jacp<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
</span><span class="code-line">        I <span class="token operator">=</span> np<span class="token punctuation">.</span>identity<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
</span><span class="code-line">        product <span class="token operator">=</span> jacp<span class="token punctuation">.</span>T @ jacp <span class="token operator">+</span> damping <span class="token operator">*</span> I
</span><span class="code-line">
</span><span class="code-line">        <span class="token keyword">if</span> np<span class="token punctuation">.</span>isclose<span class="token punctuation">(</span>np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>det<span class="token punctuation">(</span>product<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</span><span class="code-line">            j_inv <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>pinv<span class="token punctuation">(</span>product<span class="token punctuation">)</span> @ jacp<span class="token punctuation">.</span>T
</span><span class="code-line">        <span class="token keyword">else</span><span class="token punctuation">:</span>
</span><span class="code-line">            j_inv <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>inv<span class="token punctuation">(</span>product<span class="token punctuation">)</span> @ jacp<span class="token punctuation">.</span>T
</span><span class="code-line">
</span><span class="code-line">        delta_q <span class="token operator">=</span> j_inv @ error
</span><span class="code-line">
</span><span class="code-line">        <span class="token comment">#Compute next step</span>
</span><span class="code-line">        q <span class="token operator">=</span> data<span class="token punctuation">.</span>qpos<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        q <span class="token operator">+=</span> step_size <span class="token operator">*</span> delta_q
</span><span class="code-line">        
</span><span class="code-line">        <span class="token comment">#Check limits</span>
</span><span class="code-line">        check_joint_limits<span class="token punctuation">(</span>data<span class="token punctuation">.</span>qpos<span class="token punctuation">)</span>
</span><span class="code-line">        
</span><span class="code-line">        <span class="token comment">#Set control signal</span>
</span><span class="code-line">        data<span class="token punctuation">.</span>ctrl <span class="token operator">=</span> q 
</span><span class="code-line">        <span class="token comment">#Step the simulation.</span>
</span><span class="code-line">        mujoco<span class="token punctuation">.</span>mj_step<span class="token punctuation">(</span>model<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
</span><span class="code-line">
</span><span class="code-line">        error <span class="token operator">=</span> np<span class="token punctuation">.</span>subtract<span class="token punctuation">(</span>goal<span class="token punctuation">,</span> data<span class="token punctuation">.</span>body<span class="token punctuation">(</span>end_effector_id<span class="token punctuation">)</span><span class="token punctuation">.</span>xpos<span class="token punctuation">)</span>
</span><span class="code-line">    
</span><span class="code-line">    <span class="token comment">#Render and save frames.</span>
</span><span class="code-line">    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>frames<span class="token punctuation">)</span> <span class="token operator">&#x3C;</span> data<span class="token punctuation">.</span>time <span class="token operator">*</span> FRAMERATE<span class="token punctuation">:</span>
</span><span class="code-line">        renderer<span class="token punctuation">.</span>update_scene<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
</span><span class="code-line">        pixels <span class="token operator">=</span> renderer<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span>
</span><span class="code-line">        frames<span class="token punctuation">.</span>append<span class="token punctuation">(</span>pixels<span class="token punctuation">)</span>
</span><span class="code-line">        
</span><span class="code-line"><span class="token comment">#Display video.</span>
</span><span class="code-line">media<span class="token punctuation">.</span>show_video<span class="token punctuation">(</span>frames<span class="token punctuation">,</span> fps<span class="token operator">=</span>FRAMERATE<span class="token punctuation">)</span>
</span></code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>So that's all for now! You've seen how MuJoCo can be used to implement simple
Inverse Kinematics. Keep in mind that this approach may not always produce
optimal values for your specific needs and may not consider orientation. From
here, you can start experimenting with different techniques to fine-tune your
implementations using the libraries that I used.</p>
<p>If you find any errors or would like to add more information, please DM me on
<a href="https://twitter.com/_Alefram_">Twitter/x</a> or send me an
<a href="mailto:fraumalex@gmail.com">email</a> to update this post. I would appreciate it.</p>
<p>You can check the full Jupyter notebook <a href="https://github.com/alefram/notebooks/blob/master/inverse_kinematics.ipynb">here</a></p>
<p>I hope this has been helpful, and don't forget to share it with anyone who
needs it.</p>
<h2 id="reference">Reference</h2>
<ul>
<li>[1] Gauss‚ÄìNewton algorithm <a href="https://en.wikipedia.org/wiki/Gauss%E2%80%93Newton_algorithm#:~:text=The%20Gauss%E2%80%93Newton%20algorithm%20is,of%20a%20non%2Dlinear%20function.">wikipedia</a></li>
<li>[2] Anton Larsson and Oskar Gr√∂nlund <a href="https://www.diva-portal.org/smash/get/diva2:1774792/FULLTEXT01.pdf">Comparative Analysis of the Inverse Kinematics of a 6-DOF Manipulator</a></li>
<li>[3] Levenberg-Marquardt algorithm <a href="https://en.wikipedia.org/wiki/Levenberg%E2%80%93Marquardt_algorithm">wikipedia</a></li>
<li>[4] MuJoCo Python Bindings docs <a href="https://mujoco.readthedocs.io/en/stable/python.html">Docs</a></li>
<li>[5] mujoco_menagerie <a href="https://github.com/google-deepmind/mujoco_menagerie/blob/main/universal_robots_ur5e/README.md">UR5e</a></li>
<li>[6] kevinzakka mjctrl <a href="https://github.com/kevinzakka/mjctrl">repo</a></li>
<li>[7] Deepmind mujoco <a href="https://github.com/google-deepmind/mujoco">repo</a></li>
</ul></article></div></main><footer class="py-12"><div class="flex justify-center space-x-4 mt-4"><a href="https://github.com/alefram"><img alt="githubFooter" src="/images/github.svg" class="w-8"/></a><a href="https://twitter.com/FrauditaAlexis"><img alt="twitterFooter" src="/images/x.svg" class="w-8"/></a></div><div class="text-center text-lg text-neutral-900 dark:text-neutral-100"><small>Make with üíô ¬©<!-- -->2024<!-- --> All rights reserved</small></div></footer></div></div><script id="__NEXT_DATA__" type="application/json" crossorigin="">{"props":{"pageProps":{"postData":{"id":"Basic-inverse-kinematics-in-Mujoco","contentHtml":"\u003cp\u003eIn my journey exploring the fundamentals of robot manipulation, I was curious\nabout how to perform simple inverse kinematics. I'm aware that numerous\nlibraries exist to handle this topic, but I'd like to practice translating the\nmath/pseudocode into actual implementation, particularly in MuJoCo, which\nis my primary simulator for conducting experiments at the moment. Here's what\nI discovered:\u003c/p\u003e\n\u003ch2 id=\"what-is-inverse-kinematics\"\u003eWhat is inverse kinematics\u003c/h2\u003e\n\u003cp\u003eImagine you have a six-joint robot manipulator with an end-effector, like a\ngripper, at its tip. You want to move this end-effector to a specific point in\n3D space to perform a task. To achieve this, you need to determine the exact\njoint coordinates required to position the end-effector at your desired point.\nThis is where inverse kinematics comes into play.\u003c/p\u003e\n\u003cp\u003eInverse kinematics is the process of mapping the end-effector's pose\n(position and orientation) to the joint coordinates that will achieve that pose.\nBy using inverse kinematics, you can find the specific joint angles needed to\nmove the end-effector to your desired point in 3D space.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/ik-diagram.svg\" alt=\"ik-diagram\"\u003e\u003c/p\u003e\n\u003cp\u003eGiven that there are two ways to solve inverse kinematics: the analytical\napproach and the numerical approach. The analytical approach involves using the\nmathematical model to solve for the joint angles required to achieve a desired\nend-effector pose. On the other hand, the numerical approach involves using\niterative calculations to approximate the joint angles using an optimization\nalgorithm.\u003c/p\u003e\n\u003cp\u003eIn this article I will focus on the numerical approaches that I found.\u003c/p\u003e\n\u003ch2 id=\"inverse-kinematics-algorithms\"\u003eInverse Kinematics algorithms\u003c/h2\u003e\n\u003cp\u003eWhile searching for the most common ways to compute inverse kinematics, I\ndiscovered the master thesis of \u003cstrong\u003eAnton Larsson\u003c/strong\u003e and \u003cstrong\u003eOskar Gr√∂nlund\u003c/strong\u003e titled\n\"Comparative Analysis of the Inverse Kinematics of a 6-DOF Manipulator\". In\nthis thesis, they discuss the use of the Jacobian to approximate the\nrelationship between joint angles and desired end-effector position. They\nexplain three methods for doing this: \u003cstrong\u003eGradient Descent\u003c/strong\u003e, \u003cstrong\u003eGauss-Newton\u003c/strong\u003e,\nand \u003cstrong\u003eLevenberg-Marquardt\u003c/strong\u003e.\u003c/p\u003e\n\u003ch3 id=\"gauss-newton\"\u003eGauss-Newton\u003c/h3\u003e\n\u003cp\u003eThe Gauss-Newton algorithm is a extension of a Newton's method for finding a\nminimum value of a non-linear function [1]. It starts by defining an initial\nguess \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ex_{n}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e and estimate the next best optimal value denote by \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ex_{n+1}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6389em;vertical-align:-0.2083em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003cspan class=\"mbin mtight\"\u003e+\u003c/span\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2083em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\nusing the equation (1).\u003c/p\u003e\n\u003cdiv class=\"math math-display\"\u003e\u003cspan class=\"katex-display\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmtable rowspacing=\"0.25em\" columnalign=\"right\" columnspacing=\"\"\u003e\u003cmtr\u003e\u003cmtd class=\"mtr-glue\"\u003e\u003c/mtd\u003e\u003cmtd\u003e\u003cmstyle scriptlevel=\"0\" displaystyle=\"true\"\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003cmo\u003e‚àí\u003c/mo\u003e\u003cmfrac\u003e\u003cmrow\u003e\u003cmsup\u003e\u003cmi\u003ef\u003c/mi\u003e\u003cmo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\"\u003e‚Ä≤\u003c/mo\u003e\u003c/msup\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cmrow\u003e\u003cmsup\u003e\u003cmi\u003ef\u003c/mi\u003e\u003cmrow\u003e\u003cmo mathvariant=\"normal\"\u003e‚Ä≤\u003c/mo\u003e\u003cmo mathvariant=\"normal\"\u003e‚Ä≤\u003c/mo\u003e\u003c/mrow\u003e\u003c/msup\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003c/mfrac\u003e\u003c/mrow\u003e\u003c/mstyle\u003e\u003c/mtd\u003e\u003cmtd class=\"mtr-glue\"\u003e\u003c/mtd\u003e\u003cmtd class=\"mml-eqn-num\"\u003e\u003c/mtd\u003e\u003c/mtr\u003e\u003c/mtable\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\begin{align}\n    x_{n+1} = x_{n} - \\frac{f^{\\prime}(x_{n})}{f^{\\prime\\prime}(x_{n})}\n\\end{align}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:2.6649em;vertical-align:-1.0824em;\"\u003e\u003c/span\u003e\u003cspan class=\"mtable\"\u003e\u003cspan class=\"col-align-r\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.5824em;\"\u003e\u003cspan style=\"top:-3.5824em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3.4289em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003cspan class=\"mbin mtight\"\u003e+\u003c/span\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2083em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e‚àí\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mopen nulldelimiter\"\u003e\u003c/span\u003e\u003cspan class=\"mfrac\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.4289em;\"\u003e\u003cspan style=\"top:-2.314em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\"\u003ef\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.6779em;\"\u003e\u003cspan style=\"top:-2.989em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e‚Ä≤‚Ä≤\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.23em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"frac-line\" style=\"border-bottom-width:0.04em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"top:-3.677em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\"\u003ef\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.7519em;\"\u003e\u003cspan style=\"top:-3.063em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e‚Ä≤\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.936em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose nulldelimiter\"\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.0824em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"tag\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.5824em;\"\u003e\u003cspan style=\"top:-3.5824em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3.4289em;\"\u003e\u003c/span\u003e\u003cspan class=\"eqn-num\"\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.0824em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/div\u003e\n\u003cp\u003eWhere \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsup\u003e\u003cmi\u003ef\u003c/mi\u003e\u003cmo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\"\u003e‚Ä≤\u003c/mo\u003e\u003c/msup\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ef^{\\prime}(x_{n})\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1.0019em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\"\u003ef\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.7519em;\"\u003e\u003cspan style=\"top:-3.063em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e‚Ä≤\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e represents the gradient of the cost\nfunction at the current point \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ex_{n}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e, while \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsup\u003e\u003cmi\u003ef\u003c/mi\u003e\u003cmrow\u003e\u003cmo mathvariant=\"normal\"\u003e‚Ä≤\u003c/mo\u003e\u003cmo mathvariant=\"normal\"\u003e‚Ä≤\u003c/mo\u003e\u003c/mrow\u003e\u003c/msup\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ef^{\\prime\\prime}(x_{n})\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1.0019em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\"\u003ef\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.7519em;\"\u003e\u003cspan style=\"top:-3.063em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e‚Ä≤‚Ä≤\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e denotes\nthe second derivative of the cost function at the same point, known as the\n\"\u003cstrong\u003eHessian matrix\u003c/strong\u003e\". The Hessian matrix measures how the gradient changes as the\nparameters change. This equation updates the current point \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ex_{n}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e by moving in\na direction that minimizes the cost function, considering both the gradient and\nthe curvature of the cost function at that point. If you'd like to explore this\ntechnique further, I recommend referring to the thesis by Anton and Oskar for\nmore detailed information.\u003c/p\u003e\n\u003cp\u003eThe Gauss-Newton method approximates the \u003cstrong\u003eHessian matrix\u003c/strong\u003e using the Jacobian\nmatrix to establish the relationship between joints and end-effector position.\nHowever, in Anton and Oskar's thesis, they utilize the pseudo-inverse of the\nJacobian matrix, as seen in equation (2), instead of the original version.\u003c/p\u003e\n\u003cdiv class=\"math math-display\"\u003e\u003cspan class=\"katex-display\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmtable rowspacing=\"0.25em\" columnalign=\"right\" columnspacing=\"\"\u003e\u003cmtr\u003e\u003cmtd class=\"mtr-glue\"\u003e\u003c/mtd\u003e\u003cmtd\u003e\u003cmstyle scriptlevel=\"0\" displaystyle=\"true\"\u003e\u003cmrow\u003e\u003cmsup\u003e\u003cmi\u003eJ\u003c/mi\u003e\u003cmo lspace=\"0em\" rspace=\"0em\"\u003e‚Ä†\u003c/mo\u003e\u003c/msup\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmsup\u003e\u003cmi\u003eJ\u003c/mi\u003e\u003cmi\u003eT\u003c/mi\u003e\u003c/msup\u003e\u003cmi\u003eJ\u003c/mi\u003e\u003cmsup\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmrow\u003e\u003cmo\u003e‚àí\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/mrow\u003e\u003c/msup\u003e\u003cmsup\u003e\u003cmi\u003eJ\u003c/mi\u003e\u003cmi\u003eT\u003c/mi\u003e\u003c/msup\u003e\u003c/mrow\u003e\u003c/mstyle\u003e\u003c/mtd\u003e\u003cmtd class=\"mtr-glue\"\u003e\u003c/mtd\u003e\u003cmtd class=\"mml-eqn-num\"\u003e\u003c/mtd\u003e\u003c/mtr\u003e\u003c/mtable\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\begin{align}\n    J^{\\dagger} = (J^{T}J)^{-1}J^{T}\n\\end{align}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1.5591em;vertical-align:-0.5296em;\"\u003e\u003c/span\u003e\u003cspan class=\"mtable\"\u003e\u003cspan class=\"col-align-r\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.0296em;\"\u003e\u003cspan style=\"top:-3.1304em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.09618em;\"\u003eJ\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8991em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e‚Ä†\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.09618em;\"\u003eJ\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8913em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\"\u003eT\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.09618em;\"\u003eJ\u003c/span\u003e\u003cspan class=\"mclose\"\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8641em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e‚àí\u003c/span\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.09618em;\"\u003eJ\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8913em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\"\u003eT\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.5296em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"tag\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.0296em;\"\u003e\u003cspan style=\"top:-3.0296em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.8991em;\"\u003e\u003c/span\u003e\u003cspan class=\"eqn-num\"\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.5296em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/div\u003e\n\u003cp\u003eThen the equation (1) turns to.\u003c/p\u003e\n\u003cdiv class=\"math math-display\"\u003e\u003cspan class=\"katex-display\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmtable rowspacing=\"0.25em\" columnalign=\"right\" columnspacing=\"\"\u003e\u003cmtr\u003e\u003cmtd class=\"mtr-glue\"\u003e\u003c/mtd\u003e\u003cmtd\u003e\u003cmstyle scriptlevel=\"0\" displaystyle=\"true\"\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003cmo\u003e‚àí\u003c/mo\u003e\u003cmsup\u003e\u003cmi\u003eH\u003c/mi\u003e\u003cmrow\u003e\u003cmo\u003e‚àí\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/mrow\u003e\u003c/msup\u003e\u003cmi mathvariant=\"normal\"\u003e‚àá\u003c/mi\u003e\u003cmi\u003ef\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003cmo\u003e‚àí\u003c/mo\u003e\u003cmsup\u003e\u003cmi\u003eJ\u003c/mi\u003e\u003cmo lspace=\"0em\" rspace=\"0em\"\u003e‚Ä†\u003c/mo\u003e\u003c/msup\u003e\u003cmi\u003er\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003c/mstyle\u003e\u003c/mtd\u003e\u003cmtd class=\"mtr-glue\"\u003e\u003c/mtd\u003e\u003cmtd class=\"mml-eqn-num\"\u003e\u003c/mtd\u003e\u003c/mtr\u003e\u003c/mtable\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\begin{align}\n    x_{n+1} = x_{n} - H^{-1}\\nabla f(x_{n}) = x_{n} - J^{\\dagger}r(x)\n\\end{align}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1.5591em;vertical-align:-0.5296em;\"\u003e\u003c/span\u003e\u003cspan class=\"mtable\"\u003e\u003cspan class=\"col-align-r\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.0296em;\"\u003e\u003cspan style=\"top:-3.1304em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003cspan class=\"mbin mtight\"\u003e+\u003c/span\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2083em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e‚àí\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.08125em;\"\u003eH\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8641em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e‚àí\u003c/span\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e‚àá\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\"\u003ef\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e‚àí\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.09618em;\"\u003eJ\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8991em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e‚Ä†\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\"\u003er\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.5296em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"tag\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.0296em;\"\u003e\u003cspan style=\"top:-3.0296em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.8991em;\"\u003e\u003c/span\u003e\u003cspan class=\"eqn-num\"\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.5296em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/div\u003e\n\u003cp\u003eIn the thesis, they also provides a pseudocode to use.\u003c/p\u003e\n\u003cpre class=\"language-latex\"\u003e\u003ccode class=\"language-latex code-highlight\"\u003e\u003cspan class=\"code-line\"\u003egoal_pose = y\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eq = current joint angles\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003estep_size = desired step size\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003etolerance = set tolerance\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ee = goal_pose - current_pose\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ewhile norm(e) \u003e= tolerance do\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    J = Jacobian(q)\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    J_T = J.transpose()\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    J_pinv = (J_T * J).inv() * J_T\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    delta_q = J_pinv * e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    q += step_size * delta_q\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    q = check_joint_limits(q)\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    e = goal_pose - ForwardKinematics(q)\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eend while\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"gradient-descent\"\u003eGradient Descent\u003c/h3\u003e\n\u003cp\u003eThe gradient descent method, also known as the \u003cstrong\u003eJacobian transpose method\u003c/strong\u003e, is\nanother numerical approach to solving the inverse kinematics optimization\nproblem. This method solves the problem by iteratively adjusting the joint\nangles to reduce the error between the desired and actual end-effector position.\u003c/p\u003e\n\u003cp\u003eIn order to obtain the joint angles, the gradient descent method utilizes the\ntranspose of the Jacobian matrix to map the difference between the actual and\ndesired end-effector positions to the angles of the joints [2]. This is\nachieved by calculating the gradient using equation (3)\u003c/p\u003e\n\u003cdiv class=\"math math-display\"\u003e\u003cspan class=\"katex-display\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmtable rowspacing=\"0.25em\" columnalign=\"right\" columnspacing=\"\"\u003e\u003cmtr\u003e\u003cmtd class=\"mtr-glue\"\u003e\u003c/mtd\u003e\u003cmtd\u003e\u003cmstyle scriptlevel=\"0\" displaystyle=\"true\"\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmi\u003ex\u003c/mi\u003e\u003c/msub\u003e\u003cmo\u003e‚àí\u003c/mo\u003e\u003cmi\u003eŒ±\u003c/mi\u003e\u003cmi mathvariant=\"normal\"\u003e‚àá\u003c/mi\u003e\u003cmi\u003ef\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003cmo\u003e‚àí\u003c/mo\u003e\u003cmi\u003eŒ±\u003c/mi\u003e\u003cmsup\u003e\u003cmi\u003eJ\u003c/mi\u003e\u003cmi\u003eT\u003c/mi\u003e\u003c/msup\u003e\u003cmi\u003er\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003c/mstyle\u003e\u003c/mtd\u003e\u003cmtd class=\"mtr-glue\"\u003e\u003c/mtd\u003e\u003cmtd class=\"mml-eqn-num\"\u003e\u003c/mtd\u003e\u003c/mtr\u003e\u003c/mtable\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\begin{align}\n    x_{n+1} = x_{x} - \\alpha \\nabla f(x_{n}) = x_{n} - \\alpha J^{T}r(x)\n\\end{align}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1.5513em;vertical-align:-0.5257em;\"\u003e\u003c/span\u003e\u003cspan class=\"mtable\"\u003e\u003cspan class=\"col-align-r\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.0257em;\"\u003e\u003cspan style=\"top:-3.1343em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003cspan class=\"mbin mtight\"\u003e+\u003c/span\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2083em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003ex\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e‚àí\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.0037em;\"\u003eŒ±\u003c/span\u003e\u003cspan class=\"mord\"\u003e‚àá\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\"\u003ef\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e‚àí\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.0037em;\"\u003eŒ±\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.09618em;\"\u003eJ\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8913em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\"\u003eT\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\"\u003er\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.5257em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"tag\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.0257em;\"\u003e\u003cspan style=\"top:-3.0257em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.8913em;\"\u003e\u003c/span\u003e\u003cspan class=\"eqn-num\"\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.5257em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/div\u003e\n\u003cp\u003eWhere \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eŒ±\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\alpha\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.0037em;\"\u003eŒ±\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e is the learning rate that define the size of the step taken into\nthe direction of the steepest descent during each iteraction [2]. Also is commun\nto define this parameter by trial and error.\u003c/p\u003e\n\u003cpre class=\"language-latex\"\u003e\u003ccode class=\"language-latex code-highlight\"\u003e\u003cspan class=\"code-line\"\u003egoal_pose = y\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eq = current joint angles\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003estep_size = desired step size\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003etolerance = set tolerance\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ee = goal_pose - current_pose\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ewhile norm(e) \u003e= tolerance do\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    J = Jacobian(q)\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    J_T = J.transpose()\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    gradient = alpha * J_T * e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    q += step_size * gradient\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    q = check_joint_limits(q)\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    e = goal_pose - ForwardKinematics(q)\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eend while\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"levenberg-marquardt\"\u003eLevenberg-Marquardt\u003c/h3\u003e\n\u003cp\u003eThe \u003cstrong\u003eLevenberg-Marquardt method\u003c/strong\u003e, is a combination of \u003cstrong\u003eGauss-Newton\u003c/strong\u003e and\n\u003cstrong\u003egradient descent\u003c/strong\u003e using the following equation.\u003c/p\u003e\n\u003cdiv class=\"math math-display\"\u003e\u003cspan class=\"katex-display\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"\u003e\u003csemantics\u003e\u003cmtable rowspacing=\"0.25em\" columnalign=\"right\" columnspacing=\"\"\u003e\u003cmtr\u003e\u003cmtd class=\"mtr-glue\"\u003e\u003c/mtd\u003e\u003cmtd\u003e\u003cmstyle scriptlevel=\"0\" displaystyle=\"true\"\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmrow\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/mrow\u003e\u003c/msub\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmsup\u003e\u003cmi\u003eJ\u003c/mi\u003e\u003cmi\u003eT\u003c/mi\u003e\u003c/msup\u003e\u003cmi\u003eJ\u003c/mi\u003e\u003cmo\u003e+\u003c/mo\u003e\u003cmi\u003eŒª\u003c/mi\u003e\u003cmi\u003eI\u003c/mi\u003e\u003cmsup\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003cmrow\u003e\u003cmo\u003e‚àí\u003c/mo\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/mrow\u003e\u003c/msup\u003e\u003cmsup\u003e\u003cmi\u003eJ\u003c/mi\u003e\u003cmi\u003eT\u003c/mi\u003e\u003c/msup\u003e\u003cmi\u003er\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003c/mstyle\u003e\u003c/mtd\u003e\u003cmtd class=\"mtr-glue\"\u003e\u003c/mtd\u003e\u003cmtd class=\"mml-eqn-num\"\u003e\u003c/mtd\u003e\u003c/mtr\u003e\u003c/mtable\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\begin{align}\n    x_{n+1} = x_{n} + (J^{T}J + \\lambda I)^{-1}J^{T}r(x_{n})\n\\end{align}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1.5513em;vertical-align:-0.5257em;\"\u003e\u003c/span\u003e\u003cspan class=\"mtable\"\u003e\u003cspan class=\"col-align-r\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.0257em;\"\u003e\u003cspan style=\"top:-3.1343em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:3em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003cspan class=\"mbin mtight\"\u003e+\u003c/span\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.2083em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e+\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.09618em;\"\u003eJ\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8913em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\"\u003eT\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.09618em;\"\u003eJ\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e+\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eŒª\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.07847em;\"\u003eI\u003c/span\u003e\u003cspan class=\"mclose\"\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8641em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e‚àí\u003c/span\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.09618em;\"\u003eJ\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.8913em;\"\u003e\u003cspan style=\"top:-3.113em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\" style=\"margin-right:0.13889em;\"\u003eT\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\"\u003er\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.5257em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"tag\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:1.0257em;\"\u003e\u003cspan style=\"top:-3.0257em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.8913em;\"\u003e\u003c/span\u003e\u003cspan class=\"eqn-num\"\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.5257em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/div\u003e\n\u003cp\u003eWhere \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ex_{n}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e represents the current value of x at the n-th iteration, \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eJ\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eJ\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.09618em;\"\u003eJ\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e is\nthe Jacobian matrix of the \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ef\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ef(x)\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\"\u003ef\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e function, \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003er\u003c/mi\u003e\u003cmo stretchy=\"false\"\u003e(\u003c/mo\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003cmo stretchy=\"false\"\u003e)\u003c/mo\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003er(x_{n})\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.02778em;\"\u003er\u003c/span\u003e\u003cspan class=\"mopen\"\u003e(\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"mclose\"\u003e)\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e denotes the residual\nvector at \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003ex\u003c/mi\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ex_{n}\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\"\u003ex\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.1514em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e\u003cspan class=\"mord mathnormal mtight\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e‚Äã\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e, \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eŒª\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\lambda\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eŒª\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e is a \u003cstrong\u003edamping\u003c/strong\u003e factor used to control the step size,\nand \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eI\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eI\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.07847em;\"\u003eI\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e represents the identity matrix.\u003c/p\u003e\n\u003cp\u003eSimilar to \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eŒ±\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\alpha\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.0037em;\"\u003eŒ±\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e, the parameter \u003cspan class=\"math math-inline\"\u003e\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003eŒª\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003e\\lambda\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003eŒª\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e is also determined through a\nprocess of trial and error.\u003c/p\u003e\n\u003cpre class=\"language-latex\"\u003e\u003ccode class=\"language-latex code-highlight\"\u003e\u003cspan class=\"code-line\"\u003egoal_pose = y\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eq = current joint angles\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003estep_size = desired step size\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003etolerance = set tolerance\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ee = goal_pose - current_pose\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003elambda = damping factor\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ewhile norm(e) \u003e= tolerance do\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    J = Jacobian(q)\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    J_T = Jacobian.transpose()\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    J_inv = (J_T * J + lambda * I).inv() * J_T\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    delta_q = J_inv * e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    q += step_size * delta_q\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    q = check_joint_limits(q)\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    e = goal_pose - ForwardKinematics(q)\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eend while\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"implementation\"\u003eImplementation\u003c/h2\u003e\n\u003cp\u003eSeeing that they provide the pseudocode for each algorithm, I have the idea of\ntrying to re-implement these techniques in \u003cstrong\u003eMuJoCo\u003c/strong\u003e for practice. Let me\nexplain how I do it.\u003c/p\u003e\n\u003cp\u003eFirst, you need to install the necessary libraries for coding. In this case,\nI decided to use the Python bindings of the\n\u003ca href=\"https://mujoco.readthedocs.io/en/stable/python.xml\"\u003eMuJoCo library\u003c/a\u003e.\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python code-highlight\"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e numpy \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e np\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e mujoco\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e mujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eviewer \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e viewer\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e mediapy \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e media\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThen, choose a MuJoCo robot arm model to test our inverse kinematics. In this\ncase I decided to use the UR5e robot arm from the \u003cstrong\u003emujoco_menangerie\u003c/strong\u003e\n\u003ca href=\"https://github.com/google-deepmind/mujoco_menagerie/blob/main/universal_robots_ur5e/README.md\"\u003elibrary\u003c/a\u003e\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python code-highlight\"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#add path\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003exml \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\u0026#x3C;path\u003e/mujoco_menagerie/universal_robots_ur5e/scene.xml\"\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003emodel \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e mujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eMjModel\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003efrom_xml_path\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003exml\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003edata \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e mujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eMjData\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003erenderer \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e mujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eRenderer\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eI also created a new camera, to get a better view of the robot.\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python code-highlight\"\u003e\u003cspan class=\"code-line\"\u003ecamera \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e mujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eMjvCamera\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003emujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emjv_defaultFreeCamera\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e camera\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ecamera\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edistance \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eOne important thing to ensure the correctness of an algorithm is to have a\n\"test coordinate.\" To do this, I choosed the position of the joints that give\na good visualization by trial and error and use the \"\u003cstrong\u003ewrist 3\u003c/strong\u003e\" link, which is\nthe last piece of the robot model, as an \u003cstrong\u003eend-effector\u003c/strong\u003e\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python code-highlight\"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Put a position of the joints to get a test point\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003epi \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epi\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003epi\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003epi\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e pi\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003epi\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token operator\"\u003e*\u003c/span\u003epi\u003cspan class=\"token operator\"\u003e/\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Initial joint position\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eqpos0 \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecopy\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Step the simulation.\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003emujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_forward\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Use the last piece as an \"end effector\" to get a test point in cartesian \u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e# coordinates\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003etarget \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'wrist_3_link'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003expos\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Target =\u003e\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003etarget\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Plot results\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Results\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003emujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_resetDataKeyframe\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003emujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_forward\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003einit_point \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'wrist_3_link'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003expos\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecopy\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003erenderer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eupdate_scene\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e camera\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003etarget_plot \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e renderer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erender\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e qpos0\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003emujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_forward\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eresult_point \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'wrist_3_link'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003expos\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecopy\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003erenderer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eupdate_scene\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e camera\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eresult_plot \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e renderer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erender\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"initial point =\u003e\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e init_point\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Desire point =\u003e\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e result_point\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eimages \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token string\"\u003e'Initial position'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e target_plot\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token string\"\u003e' Desire end effector position'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e result_plot\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003emedia\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eshow_images\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eimages\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd this is what I've got.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/test_point.png\" alt=\"test coordinate\"\u003e\u003c/p\u003e\n\u003cp\u003eNow let's create the algorithms.\u003c/p\u003e\n\u003cp\u003eAs you can see in the pseudocode, there is something similar among all of them,\nwhich is that they all use the \u003cstrong\u003eJacobian\u003c/strong\u003e. Fortunately, MuJoCo provides a method\nthat allows us to calculate the Jacobian without having to do it manually,\nwhich is called \u003ca href=\"https://mujoco.readthedocs.io/en/stable/APIreference/APIfunctions.html?highlight=mj_jac#mj-jac\"\u003e\u003cstrong\u003emj_jac\u003c/strong\u003e\u003c/a\u003e.\nIt can be a big help in creating these algorithms.\u003c/p\u003e\n\u003cp\u003eI created a class for the different algorithms to make their use simpler. In\nthis class, I defined the \u003cstrong\u003echeck_joint_limits\u003c/strong\u003e method in the pseudocode and the\n\u003cstrong\u003ecalculate\u003c/strong\u003e method, where I implemented the algorithm using the MuJoCo library and\nNumPy.\u003c/p\u003e\n\u003cp\u003eAfter implementing the algorithms, I initialized the variables for each one.\nThese values change a lot depending on the distance from the starting angles,\nso I determined the values through the results of Anton\u0026#x26;Oskar thesis and trial\nand error to find what works best. However, if you want to experiment with the\nparameters, feel free to do so. Finally, I rendered the model and checked if it\nworks.\u003c/p\u003e\n\u003ch3 id=\"gradient-descent\"\u003eGradient descent\u003c/h3\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python code-highlight\"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e# Gradient Descent method\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eGradientDescentIK\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003e__init__\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e step_size\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e tol\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e alpha\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e jacp\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e jacr\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emodel \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e model\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e data\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estep_size \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e step_size\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etol \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e tol\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ealpha \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e alpha\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejacp \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e jacp\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejacr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e jacr\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003echeck_joint_limits\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e q\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token triple-quoted-string string\"\u003e\"\"\"Check if the joints is under or above its limits\"\"\"\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token builtin\"\u003elen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eq\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            q\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003emax\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejnt_range\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e                       \u003cspan class=\"token builtin\"\u003emin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eq\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejnt_range\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token comment\"\u003e#Gradient Descent pseudocode implementation\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003ecalculate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e goal\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e init_q\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e body_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token triple-quoted-string string\"\u003e\"\"\"Calculate the desire joints angles for goal\"\"\"\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e init_q\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        mujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_forward\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        current_pose \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebody_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003expos\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        error \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esubtract\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egoal\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e current_pose\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token keyword\"\u003ewhile\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elinalg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enorm\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etol\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token comment\"\u003e#calculate jacobian\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            mujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_jac\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejacp\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e                          self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejacr\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e goal\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e body_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token comment\"\u003e#calculate gradient\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            grad \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ealpha \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejacp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eT @ error\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token comment\"\u003e#compute next step\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estep_size \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e grad\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token comment\"\u003e#check joint limits\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003echeck_joint_limits\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token comment\"\u003e#compute forward kinematics\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            mujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_forward\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token comment\"\u003e#calculate new error\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            error \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esubtract\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egoal\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebody_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003expos\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python code-highlight\"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Init variables.\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ebody_id \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'wrist_3_link'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token builtin\"\u003eid\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ejacp \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ezeros\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003env\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#translation jacobian\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ejacr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ezeros\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003env\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#rotational jacobian\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003egoal \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0.49\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.13\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.59\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003estep_size \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.5\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003etol \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.01\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ealpha \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.5\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003einit_q \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eik \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e GradientDescentIK\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e step_size\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e tol\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e alpha\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e jacp\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e jacr\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Get desire point\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003emujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_resetDataKeyframe\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#reset qpos to initial value\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eik\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecalculate\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egoal\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e init_q\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e body_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#calculate the q angles\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eresult \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecopy\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Plot results\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Results\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e qpos0\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003emujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_forward\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003erenderer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eupdate_scene\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e camera\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003etarget_plot \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e renderer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erender\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e result\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003emujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_forward\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eresult_point \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'wrist_3_link'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003expos\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003erenderer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eupdate_scene\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e camera\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eresult_plot \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e renderer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erender\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"testing point =\u003e\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e target\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Gradient Descent result =\u003e\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e result_point\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eimages \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token string\"\u003e'Testing point'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e target_plot\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token string\"\u003e'Gradient Descent result'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e result_plot\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003emedia\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eshow_images\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eimages\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/images/gdresult.png\" alt=\"gd-result-render\" title=\"Gradient Descent result\"\u003e\u003c/p\u003e\n\u003ch3 id=\"gauss-newton\"\u003eGauss-Newton\u003c/h3\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python code-highlight\"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e# Gauss-Newton method\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eGaussNewtonIK\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003e__init__\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e step_size\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e tol\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e alpha\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e jacp\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e jacr\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emodel \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e model\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e data\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estep_size \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e step_size\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etol \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e tol\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ealpha \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e alpha\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejacp \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e jacp\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejacr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e jacr\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003echeck_joint_limits\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e q\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token triple-quoted-string string\"\u003e\"\"\"Check if the joints is under or above its limits\"\"\"\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token builtin\"\u003elen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eq\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            q\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003emax\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejnt_range\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e                       \u003cspan class=\"token builtin\"\u003emin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eq\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejnt_range\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token comment\"\u003e# Gauss-Newton pseudocode implementation\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003ecalculate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e goal\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e init_q\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e body_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token triple-quoted-string string\"\u003e\"\"\"Calculate the desire joints angles for goal\"\"\"\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e init_q\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        mujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_forward\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        current_pose \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebody_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003expos\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        error \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esubtract\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egoal\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e current_pose\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token keyword\"\u003ewhile\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elinalg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enorm\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etol\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token comment\"\u003e#calculate jacobian\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            mujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_jac\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejacp\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e                          self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejacr\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e goal\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e body_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token comment\"\u003e#calculate delta of joint q\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            product \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejacp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eT @ self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejacp\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eisclose\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elinalg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edet\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eproduct\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e                j_inv \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elinalg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epinv\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eproduct\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e @ self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejacp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eT\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e                j_inv \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elinalg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einv\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eproduct\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e @ self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejacp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eT\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            delta_q \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e j_inv @ error\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token comment\"\u003e#compute next step\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estep_size \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e delta_q\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token comment\"\u003e#check limits\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003echeck_joint_limits\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token comment\"\u003e#compute forward kinematics\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            mujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_forward\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token comment\"\u003e#calculate new error\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            error \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esubtract\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egoal\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebody_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003expos\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python code-highlight\"\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Init variables.\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ebody_id \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'wrist_3_link'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token builtin\"\u003eid\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ejacp \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ezeros\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003env\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#translation jacobian\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ejacr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ezeros\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003env\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#rotational jacobian\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003egoal \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0.49\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.13\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.59\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003estep_size \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.5\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003etol \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.01\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ealpha \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.5\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003einit_q \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eik \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e GaussNewtonIK\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e step_size\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e tol\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e alpha\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e jacp\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e jacr\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Get desire point\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003emujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_resetDataKeyframe\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#reset qpos to initial value\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eik\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecalculate\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egoal\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e init_q\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e body_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#calculate the qpos\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eresult \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecopy\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Plot results\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Results\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e qpos0\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003emujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_forward\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003erenderer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eupdate_scene\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e camera\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003etarget_plot \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e renderer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erender\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e result\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003emujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_forward\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eresult_point \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'wrist_3_link'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003expos\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003erenderer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eupdate_scene\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e camera\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eresult_plot \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e renderer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erender\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"testing point =\u003e\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e target\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Gauss-Newton result =\u003e\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e result_point\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eimages \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token string\"\u003e'Testing point'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e target_plot\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token string\"\u003e'Gauss-Newton result'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e result_plot\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003emedia\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eshow_images\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eimages\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/images/gnresult.png\" alt=\"gn-result-render\" title=\"Gradient Descent result\"\u003e\u003c/p\u003e\n\u003ch3 id=\"levenberg-marquardt\"\u003eLevenberg-Marquardt\u003c/h3\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python code-highlight\"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Levenberg-Marquardt method\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eLevenbegMarquardtIK\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003e__init__\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e step_size\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e tol\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e alpha\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e jacp\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e jacr\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e damping\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emodel \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e model\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e data\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estep_size \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e step_size\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etol \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e tol\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ealpha \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e alpha\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejacp \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e jacp\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejacr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e jacr\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edamping \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e damping\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003echeck_joint_limits\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e q\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token triple-quoted-string string\"\u003e\"\"\"Check if the joints is under or above its limits\"\"\"\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token builtin\"\u003elen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eq\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            q\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003emax\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejnt_range\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e                       \u003cspan class=\"token builtin\"\u003emin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eq\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejnt_range\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token comment\"\u003e#Levenberg-Marquardt pseudocode implementation\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003ecalculate\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e goal\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e init_q\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e body_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token triple-quoted-string string\"\u003e\"\"\"Calculate the desire joints angles for goal\"\"\"\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e init_q\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        mujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_forward\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        current_pose \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebody_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003expos\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        error \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esubtract\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egoal\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e current_pose\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token keyword\"\u003ewhile\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elinalg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enorm\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etol\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token comment\"\u003e#calculate jacobian\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            mujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_jac\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejacp\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejacr\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e goal\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e body_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token comment\"\u003e#calculate delta of joint q\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            n \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejacp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eshape\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            I \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eidentity\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003en\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            product \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejacp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eT @ self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejacp \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edamping \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e I\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eisclose\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elinalg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edet\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eproduct\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e                j_inv \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elinalg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epinv\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eproduct\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e @ self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejacp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eT\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e                j_inv \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elinalg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einv\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eproduct\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e @ self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejacp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eT\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            delta_q \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e j_inv @ error\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token comment\"\u003e#compute next step\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003estep_size \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e delta_q\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token comment\"\u003e#check limits\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003echeck_joint_limits\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token comment\"\u003e#compute forward kinematics\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            mujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_forward\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eself\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            \u003cspan class=\"token comment\"\u003e#calculate new error\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            error \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esubtract\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egoal\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e self\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ebody_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003expos\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e  \n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python code-highlight\"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Init variables.\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ebody_id \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'wrist_3_link'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token builtin\"\u003eid\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ejacp \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ezeros\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003env\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#translation jacobian\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ejacr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ezeros\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003env\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#rotational jacobian\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003egoal \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0.49\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.13\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.59\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003estep_size \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.5\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003etol \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.01\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ealpha \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.5\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003einit_q \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003edamping \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.15\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eik \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e LevenbegMarquardtIK\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e step_size\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e tol\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e alpha\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e jacp\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e jacr\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e damping\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Get desire point\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003emujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_resetDataKeyframe\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#reset qpos to initial value\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eik\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecalculate\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egoal\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e init_q\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e body_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#calculate the qpos\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eresult \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecopy\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Plot results\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Results\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e qpos0\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003emujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_forward\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003erenderer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eupdate_scene\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e camera\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003etarget_plot \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e renderer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erender\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e result\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003emujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_forward\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eresult_point \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'wrist_3_link'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003expos\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003erenderer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eupdate_scene\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e camera\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eresult_plot \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e renderer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erender\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"testing point =\u003e\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e target\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e\"Levenberg-Marquardt result =\u003e\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e result_point\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token string\"\u003e\"\\n\"\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eimages \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token string\"\u003e'Testing point'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e target_plot\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token string\"\u003e'Levenberg-Marquardt result'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e result_plot\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003emedia\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eshow_images\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eimages\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cimg src=\"/images/lkresult.png\" alt=\"lk-result-render\" title=\"Gradient Descent result\"\u003e\u003c/p\u003e\n\u003ch2 id=\"simulation\"\u003eSimulation\u003c/h2\u003e\n\u003cp\u003eLet's try to simulate this movement. To understand how to implement it, I based\non the \u003ca href=\"https://github.com/kevinzakka/mjctrl\"\u003emjctrl\u003c/a\u003e repository from Kevin Zakka,\nwhere he explains clear and pedagogical implementations of robotics controllers,\nand by referencing the Mujoco\n\u003ca href=\"https://github.com/google-deepmind/mujoco?tab=readme-ov-file#getting-started\"\u003ecolab\u003c/a\u003e\nexamples to render the simulations.\u003c/p\u003e\n\u003cp\u003eI implemented this code in a Jupyter notebook, and to visualize my robot, I\nrender a video of it. First, I set up the video parameters so that the video\ncan run for 4 seconds.\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python code-highlight\"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Video setup\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e mediapy \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e media\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eDURATION \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e4\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#(seconds)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eFRAMERATE \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e60\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#(Hz)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eframes \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThen, I reset the model data, initialize the parameters, and obtain the initial\nerror for the simulation. In this case, I used the \u003cstrong\u003eLevenberg-Marquardt\u003c/strong\u003e method.\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python code-highlight\"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Reset state and time\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003emujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_resetData\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Init parameters\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ejacp \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ezeros\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003env\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#translation jacobian\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ejacr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ezeros\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003env\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#rotational jacobian\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003estep_size \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.5\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003etol \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.01\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ealpha \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.5\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003edamping \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.15\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Get error.\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eend_effector_id \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'wrist_3_link'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token builtin\"\u003eid\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#\"End-effector we wish to control.\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ecurrent_pose \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eend_effector_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003expos \u003cspan class=\"token comment\"\u003e#Current pose\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003egoal \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0.49\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.13\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.59\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#Desire position\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eerror \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esubtract\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egoal\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e current_pose\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#Init Error\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eI implemented the algorithm into a loop during the \"DURATION\" of the video,\ncalculating and updating inverse kinematics on each step frame. The difference\nbetween this simulation and the last class implementations is the \u003cstrong\u003emj_step\u003c/strong\u003e\nmethod, which integrates in time and advances the simulation, applying forward\nkinematics. Finally, I rendered and saved frames and displayed them using the\n\u003cstrong\u003eMediaPy library\u003c/strong\u003e.\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python code-highlight\"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Simulate\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003ewhile\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etime \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e DURATION\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e       \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elinalg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enorm\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e=\u003c/span\u003e tol\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token comment\"\u003e#Calculate jacobian\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        mujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_jac\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e jacp\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e jacr\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e goal\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e end_effector_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token comment\"\u003e#Calculate delta of joint q\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        n \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e jacp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eshape\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        I \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eidentity\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003en\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        product \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e jacp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eT @ jacp \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e damping \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e I\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eisclose\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elinalg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edet\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eproduct\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            j_inv \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elinalg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epinv\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eproduct\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e @ jacp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eT\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            j_inv \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elinalg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einv\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eproduct\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e @ jacp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eT\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        delta_q \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e j_inv @ error\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token comment\"\u003e#Compute next step\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        q \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecopy\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        q \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e step_size \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e delta_q\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token comment\"\u003e#Check limits\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        check_joint_limits\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token comment\"\u003e#Set control signal\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ectrl \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e q\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token comment\"\u003e#Step the simulation.\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        mujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_step\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        error \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esubtract\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egoal\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eend_effector_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003expos\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token comment\"\u003e#Render and save frames.\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token builtin\"\u003elen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eframes\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etime \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e FRAMERATE\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        renderer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eupdate_scene\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        pixels \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e renderer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erender\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        frames\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eappend\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epixels\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Display video.\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003emedia\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eshow_video\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eframes\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e fps\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eFRAMERATE\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAnd this was the final result.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/robot.gif\" alt=\"robot\"\u003e\u003c/p\u003e\n\u003cp\u003eFrom here you can implement a lot of stuff, like creating a circle similar to\n\u003cstrong\u003emjctrl\u003c/strong\u003e examples.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/images/robotCircle.gif\" alt=\"robot circle\"\u003e\u003c/p\u003e\n\u003cp\u003eHere is a full code implementation.\u003c/p\u003e\n\u003cpre class=\"language-python\"\u003e\u003ccode class=\"language-python code-highlight\"\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e numpy \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e np\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e mujoco\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e mujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eviewer \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e viewer\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003eimport\u003c/span\u003e mediapy \u003cspan class=\"token keyword\"\u003eas\u003c/span\u003e media\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Video Setup\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eDURATION \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e4\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#(seconds)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eFRAMERATE \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e60\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#(Hz)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eframes \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Reset state and time.\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003emujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_resetData\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Init position.\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e# pi = np.pi\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e# data.qpos = [3*pi/2, -pi/2, pi/2, 3*pi/2, 3*pi/2, 0] #ENABLE if you want test circle\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Init parameters\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ejacp \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ezeros\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003env\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#translation jacobian\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ejacr \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ezeros\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003env\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#rotational jacobian\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003estep_size \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.5\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003etol \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.01\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ealpha \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.5\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003edamping \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.15\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Get error.\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eend_effector_id \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string\"\u003e'wrist_3_link'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token builtin\"\u003eid\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#\"End-effector we wish to control.\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003ecurrent_pose \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eend_effector_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003expos \u003cspan class=\"token comment\"\u003e#Current pose\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003egoal \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0.49\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.13\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.59\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#Desire position\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003eerror \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esubtract\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egoal\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e current_pose\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e#Init Error\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003echeck_joint_limits\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eq\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token triple-quoted-string string\"\u003e\"\"\"Check if the joints is under or above its limits\"\"\"\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token keyword\"\u003efor\u003c/span\u003e i \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"token builtin\"\u003erange\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token builtin\"\u003elen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eq\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        q\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token builtin\"\u003emax\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejnt_range\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token builtin\"\u003emin\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eq\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e model\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ejnt_range\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003edef\u003c/span\u003e \u003cspan class=\"token function\"\u003ecircle\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003et\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003efloat\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e r\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003efloat\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e h\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003efloat\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e k\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003efloat\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e f\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token builtin\"\u003efloat\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e\u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003endarray\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token triple-quoted-string string\"\u003e\"\"\"Return the (x, y) coordinates of a circle with radius r centered at (h, k)\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token triple-quoted-string string\"\u003e    as a function of time t and frequency f.\"\"\"\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    x \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e r \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecos\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epi \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e f \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e t\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e h\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    y \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e r \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esin\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epi \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e f \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e t\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e k\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    z \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0.5\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token keyword\"\u003ereturn\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003earray\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ex\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e y\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e z\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Simulate\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token keyword\"\u003ewhile\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etime \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e DURATION\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token comment\"\u003e# goal = circle(data.time, 0.1, 0.5, 0.0, 0.5) #ENABLE to test circle.\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elinalg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003enorm\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eerror\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e=\u003c/span\u003e tol\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token comment\"\u003e#Calculate jacobian\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        mujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_jac\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e jacp\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e jacr\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e goal\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e end_effector_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token comment\"\u003e#Calculate delta of joint q\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        n \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e jacp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eshape\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        I \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eidentity\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003en\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        product \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e jacp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eT @ jacp \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e damping \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e I\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eisclose\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003enp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elinalg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003edet\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eproduct\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            j_inv \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elinalg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003epinv\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eproduct\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e @ jacp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eT\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token keyword\"\u003eelse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e            j_inv \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003elinalg\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003einv\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eproduct\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e @ jacp\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eT\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        delta_q \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e j_inv @ error\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token comment\"\u003e#Compute next step\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        q \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ecopy\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        q \u003cspan class=\"token operator\"\u003e+=\u003c/span\u003e step_size \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e delta_q\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token comment\"\u003e#Check limits\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        check_joint_limits\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eqpos\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token comment\"\u003e#Set control signal\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ectrl \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e q \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \u003cspan class=\"token comment\"\u003e#Step the simulation.\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        mujoco\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emj_step\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003emodel\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        error \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e np\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esubtract\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003egoal\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003ebody\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eend_effector_id\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003expos\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token comment\"\u003e#Render and save frames.\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e    \u003cspan class=\"token keyword\"\u003eif\u003c/span\u003e \u003cspan class=\"token builtin\"\u003elen\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eframes\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e data\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003etime \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e FRAMERATE\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        renderer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eupdate_scene\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003edata\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        pixels \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e renderer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003erender\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        frames\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eappend\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003epixels\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e        \n\u003c/span\u003e\u003cspan class=\"code-line\"\u003e\u003cspan class=\"token comment\"\u003e#Display video.\u003c/span\u003e\n\u003c/span\u003e\u003cspan class=\"code-line\"\u003emedia\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eshow_video\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eframes\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e fps\u003cspan class=\"token operator\"\u003e=\u003c/span\u003eFRAMERATE\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"conclusion\"\u003eConclusion\u003c/h2\u003e\n\u003cp\u003eSo that's all for now! You've seen how MuJoCo can be used to implement simple\nInverse Kinematics. Keep in mind that this approach may not always produce\noptimal values for your specific needs and may not consider orientation. From\nhere, you can start experimenting with different techniques to fine-tune your\nimplementations using the libraries that I used.\u003c/p\u003e\n\u003cp\u003eIf you find any errors or would like to add more information, please DM me on\n\u003ca href=\"https://twitter.com/_Alefram_\"\u003eTwitter/x\u003c/a\u003e or send me an\n\u003ca href=\"mailto:fraumalex@gmail.com\"\u003eemail\u003c/a\u003e to update this post. I would appreciate it.\u003c/p\u003e\n\u003cp\u003eYou can check the full Jupyter notebook \u003ca href=\"https://github.com/alefram/notebooks/blob/master/inverse_kinematics.ipynb\"\u003ehere\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003eI hope this has been helpful, and don't forget to share it with anyone who\nneeds it.\u003c/p\u003e\n\u003ch2 id=\"reference\"\u003eReference\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e[1] Gauss‚ÄìNewton algorithm \u003ca href=\"https://en.wikipedia.org/wiki/Gauss%E2%80%93Newton_algorithm#:~:text=The%20Gauss%E2%80%93Newton%20algorithm%20is,of%20a%20non%2Dlinear%20function.\"\u003ewikipedia\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e[2] Anton Larsson and Oskar Gr√∂nlund \u003ca href=\"https://www.diva-portal.org/smash/get/diva2:1774792/FULLTEXT01.pdf\"\u003eComparative Analysis of the Inverse Kinematics of a 6-DOF Manipulator\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e[3] Levenberg-Marquardt algorithm \u003ca href=\"https://en.wikipedia.org/wiki/Levenberg%E2%80%93Marquardt_algorithm\"\u003ewikipedia\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e[4] MuJoCo Python Bindings docs \u003ca href=\"https://mujoco.readthedocs.io/en/stable/python.html\"\u003eDocs\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e[5] mujoco_menagerie \u003ca href=\"https://github.com/google-deepmind/mujoco_menagerie/blob/main/universal_robots_ur5e/README.md\"\u003eUR5e\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e[6] kevinzakka mjctrl \u003ca href=\"https://github.com/kevinzakka/mjctrl\"\u003erepo\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e[7] Deepmind mujoco \u003ca href=\"https://github.com/google-deepmind/mujoco\"\u003erepo\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e","title":"Basic inverse kinematics in MuJoCo","date":"2024-02-13","description":"Basic IK for Mujoco","keywords":"Robotics, Blog, Portfolio, inverse kinematics, Alexis Fraudita, Python"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"Basic-inverse-kinematics-in-Mujoco"},"buildId":"9Hzj17BUmxBfAAt1QDoPv","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>